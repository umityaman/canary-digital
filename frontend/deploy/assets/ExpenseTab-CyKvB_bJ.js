import{r,j as e,t as h}from"./react-vendor-DBHNAGPW.js";import{d as ne}from"./index-C00KFl1S.js";import{c as u,D as t,i as p,b as y,a as k,s as me,d as ye}from"./index-C5wiI25D.js";import{X as fe,a8 as Ne,w as be,D as ve,F as je,o as ke,a0 as Se,ac as we,f as Ee,a5 as De,ap as Te}from"./ui-vendor-CIs_GH3f.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const ze=["Personel Maaşları","Kira","Elektrik/Su/Doğalgaz","İnternet/Telefon","Malzeme Alımı","Ekipman Bakım/Onarım","Pazarlama/Reklam","Sigorta","Vergi/Harçlar","Yakıt","Seyahat/Konaklama","Yemek","Diğer"],Me=["Nakit","Banka Transferi","Kredi Kartı","Çek","Senet"],Ce=[{value:"paid",label:"Ödendi"},{value:"pending",label:"Beklemede"},{value:"cancelled",label:"İptal"}];function $e({open:g,onClose:S,onSaved:re,initial:o}){var E,I,$,de,P,ce,j,F,D,G,q,H,J,X,V,A,Q,T,W,Z,ee,ae,f,se,te,B,K,L,O,R,U,a,x,m,n,le,i,d,ue,xe,he,pe;const[l,c]=r.useState({description:"",amount:0,category:"Malzeme Alımı",date:new Date().toISOString().split("T")[0],status:"paid",paymentMethod:"Nakit",notes:"",receiptUrl:""}),[Y,w]=r.useState(!1),[M,_]=r.useState(!1);r.useEffect(()=>{c(o?{...o,date:o.date.split("T")[0]}:{description:"",amount:0,category:"Malzeme Alımı",date:new Date().toISOString().split("T")[0],status:"paid",paymentMethod:"Nakit",notes:"",receiptUrl:""})},[o,g]);const C=async s=>{var z;const N=(z=s.target.files)==null?void 0:z[0];if(!N)return;if(N.size>5*1024*1024){h.error("Dosya boyutu en fazla 5MB olabilir");return}if(!["image/jpeg","image/png","image/jpg","application/pdf"].includes(N.type)){h.error("Sadece JPG, PNG veya PDF dosyaları yüklenebilir");return}_(!0);try{const ge=URL.createObjectURL(N);c({...l,receiptUrl:ge}),h.success("Makbuz yüklendi")}catch{h.error("Makbuz yüklenirken hata oluştu")}finally{_(!1)}},ie=async s=>{var N,oe;if(s.preventDefault(),!l.description||l.amount<=0){h.error("Lütfen zorunlu alanları doldurun");return}w(!0);try{o!=null&&o.id?(await ne.updateExpense(o.id,l),h.success("Gider güncellendi")):(await ne.createExpense(l),h.success("Gider kaydedildi")),re(),S()}catch(z){console.error("Expense save error:",z),h.error(((oe=(N=z.response)==null?void 0:N.data)==null?void 0:oe.message)||z.message||"Bir hata oluştu")}finally{w(!1)}};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:u(k("lg","none","default","xl"),"w-full max-w-2xl max-h-[90vh] overflow-y-auto"),children:[e.jsxs("div",{className:u("sticky top-0 bg-white border-b border-neutral-200",(I=(E=t)==null?void 0:E.spacing)==null?void 0:I.padding.md,"flex items-center justify-between"),children:[e.jsx("h2",{className:`${(de=($=t)==null?void 0:$.typography)==null?void 0:de.h2} ${(ce=(P=t)==null?void 0:P.colors)==null?void 0:ce.text.primary}`,children:o?"Gider Düzenle":"Yeni Gider"}),e.jsx("button",{onClick:S,className:`${(F=(j=t)==null?void 0:j.colors)==null?void 0:F.text.muted} hover:text-neutral-600 transition-colors`,children:e.jsx(fe,{size:24})})]}),e.jsxs("form",{onSubmit:ie,className:u((G=(D=t)==null?void 0:D.spacing)==null?void 0:G.padding.md,"space-y-4"),children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(H=(q=t)==null?void 0:q.typography)==null?void 0:H.body.sm} font-medium ${(X=(J=t)==null?void 0:J.colors)==null?void 0:X.text.secondary} mb-2`,children:"Açıklama *"}),e.jsx("textarea",{value:l.description,onChange:s=>c({...l,description:s.target.value}),className:p("md","default",void 0,"md"),rows:3,placeholder:"Gider açıklaması...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(A=(V=t)==null?void 0:V.typography)==null?void 0:A.body.sm} font-medium ${(T=(Q=t)==null?void 0:Q.colors)==null?void 0:T.text.secondary} mb-2`,children:"Tutar (₺) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.amount,onChange:s=>c({...l,amount:parseFloat(s.target.value)}),className:p("md","default",void 0,"md"),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(Z=(W=t)==null?void 0:W.typography)==null?void 0:Z.body.sm} font-medium ${(ae=(ee=t)==null?void 0:ee.colors)==null?void 0:ae.text.secondary} mb-2`,children:"Kategori *"}),e.jsx("select",{value:l.category,onChange:s=>c({...l,category:s.target.value}),className:p("md","default",void 0,"md"),children:ze.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(se=(f=t)==null?void 0:f.typography)==null?void 0:se.body.sm} font-medium ${(B=(te=t)==null?void 0:te.colors)==null?void 0:B.text.secondary} mb-2`,children:"Tarih *"}),e.jsx("input",{type:"date",value:l.date,onChange:s=>c({...l,date:s.target.value}),className:p("md","default",void 0,"md"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(L=(K=t)==null?void 0:K.typography)==null?void 0:L.body.sm} font-medium ${(R=(O=t)==null?void 0:O.colors)==null?void 0:R.text.secondary} mb-2`,children:"Ödeme Yöntemi *"}),e.jsx("select",{value:l.paymentMethod,onChange:s=>c({...l,paymentMethod:s.target.value}),className:p("md","default",void 0,"md"),children:Me.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(a=(U=t)==null?void 0:U.typography)==null?void 0:a.body.sm} font-medium ${(m=(x=t)==null?void 0:x.colors)==null?void 0:m.text.secondary} mb-2`,children:"Durum *"}),e.jsx("select",{value:l.status,onChange:s=>c({...l,status:s.target.value}),className:p("md","default",void 0,"md"),children:Ce.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(le=(n=t)==null?void 0:n.typography)==null?void 0:le.body.sm} font-medium ${(d=(i=t)==null?void 0:i.colors)==null?void 0:d.text.secondary} mb-2`,children:"Makbuz/Fatura"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 border border-neutral-300 rounded-xl hover:bg-neutral-50 transition-colors",children:[e.jsx(Ne,{size:18}),e.jsx("span",{className:"text-sm",children:M?"Yükleniyor...":"Dosya Seç"})]}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,application/pdf",onChange:C,className:"hidden",disabled:M})]}),l.receiptUrl&&e.jsx("a",{href:l.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-neutral-900 hover:text-neutral-900",children:"Makbuzu Görüntüle"})]}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"JPG, PNG veya PDF (max 5MB)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(xe=(ue=t)==null?void 0:ue.typography)==null?void 0:xe.body.sm} font-medium ${(pe=(he=t)==null?void 0:he.colors)==null?void 0:pe.text.secondary} mb-2`,children:"Notlar"}),e.jsx("textarea",{value:l.notes,onChange:s=>c({...l,notes:s.target.value}),className:p("md","default",void 0,"md"),rows:2,placeholder:"Ek notlar..."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-neutral-200",children:[e.jsx("button",{type:"button",onClick:S,className:y("md","outline","lg"),children:"İptal"}),e.jsx("button",{type:"submit",disabled:Y,className:u(y("md","primary","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:Y?"Kaydediliyor...":o?"Güncelle":"Kaydet"})]})]})]})}):null}const b="px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase tracking-wider bg-neutral-50",v="px-6 py-4 text-sm text-neutral-900";function Le(){var B,K,L,O,R,U;const[g,S]=r.useState([]),[re,o]=r.useState(!1),[l,c]=r.useState(!1),[Y,w]=r.useState(null),[M,_]=r.useState(""),[C,ie]=r.useState(""),[E,I]=r.useState(""),[$,de]=r.useState(""),[P,ce]=r.useState(""),[j,F]=r.useState(1),[D,G]=r.useState(1),q=10,[H,J]=r.useState(0),[X,V]=r.useState(0),[A,Q]=r.useState([]);r.useEffect(()=>{T(),W()},[j,C,E,$,P]);const T=async()=>{var a,x,m;o(!0);try{const n=await ne.getExpenses({page:j,limit:q,category:C||void 0,status:E||void 0,startDate:$||void 0,endDate:P||void 0,search:M||void 0});S(((a=n==null?void 0:n.data)==null?void 0:a.data)||[]),G(((m=(x=n==null?void 0:n.data)==null?void 0:x.pagination)==null?void 0:m.totalPages)||1)}catch(n){console.warn("Failed to load expenses:",n),S([]),G(1)}finally{o(!1)}},W=async()=>{try{const a=g.reduce((i,d)=>i+d.amount,0);J(a);const x=new Date().getMonth(),m=g.filter(i=>new Date(i.date).getMonth()===x).reduce((i,d)=>i+d.amount,0);V(m);const n=new Map;g.forEach(i=>{const d=n.get(i.category)||{total:0,count:0};n.set(i.category,{total:d.total+i.amount,count:d.count+1})});const le=Array.from(n.entries()).map(([i,d])=>({category:i,total:d.total,count:d.count,percentage:d.total/a*100}));Q(le.sort((i,d)=>d.total-i.total))}catch(a){console.error("Stats calculation error:",a)}},Z=async a=>{var x,m;if(confirm("Bu gider kaydını silmek istediğinizden emin misiniz?"))try{await ne.deleteExpense(a),h.success("Gider kaydı silindi"),T()}catch(n){console.error("Failed to delete expense:",n),h.error("Silme işlemi başarısız: "+(((m=(x=n.response)==null?void 0:x.data)==null?void 0:m.message)||n.message))}},ee=a=>{w(a),c(!0)},ae=()=>{h.success("Dışa aktarma başlatıldı")},f=a=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),se=a=>new Date(a).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric"}),te=a=>{const m=ye({paid:"paid",pending:"partial",cancelled:"overdue"}[a]||a,"invoice","sm","solid");return e.jsx("span",{className:m.className,children:m.label})};return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(be,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Bu Ay"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:f(X)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Aylık Gider"})]}),e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(ve,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Toplam"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:f(H)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Toplam Gider"})]}),e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(je,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Kayıt"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:g.length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Gider Kaydı"})]})]}),A.length>0&&e.jsxs("div",{className:k("sm","md","default","lg"),children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Kategori Dağılımı"}),e.jsx("div",{className:"space-y-3",children:A.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:a.category}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-neutral-500",children:[a.count," kayıt"]}),e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:f(a.total)})]})]}),e.jsx("div",{className:"w-full bg-neutral-100 rounded-full h-2",children:e.jsx("div",{className:"bg-neutral-900 h-2 rounded-full transition-all",style:{width:`${a.percentage}%`}})})]},a.category))})]}),e.jsx("div",{className:k("sm","none","default","lg"),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${(K=(B=t)==null?void 0:B.colors)==null?void 0:K.text.muted}`,size:18}),e.jsx("input",{type:"text",placeholder:"Gider ara...",value:M,onChange:a=>_(a.target.value),className:u(p("md","default",void 0,"md"),"pl-10")})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:C,onChange:a=>ie(a.target.value),className:u(p("md","default",void 0,"md"),"flex-1 min-w-[150px] max-w-[200px]"),children:[e.jsx("option",{value:"",children:"Tüm Kategoriler"}),e.jsx("option",{value:"Personel Maaşları",children:"Personel Maaşları"}),e.jsx("option",{value:"Kira",children:"Kira"}),e.jsx("option",{value:"Elektrik/Su/Doğalgaz",children:"Elektrik/Su/Doğalgaz"}),e.jsx("option",{value:"Ekipman Bakım/Onarım",children:"Ekipman Bakım/Onarım"}),e.jsx("option",{value:"Diğer",children:"Diğer"})]}),e.jsxs("select",{value:E,onChange:a=>I(a.target.value),className:u(p("md","default",void 0,"md"),"flex-1 min-w-[130px]"),children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"paid",children:"Ödendi"}),e.jsx("option",{value:"pending",children:"Beklemede"}),e.jsx("option",{value:"cancelled",children:"İptal"})]}),e.jsxs("button",{onClick:ae,className:u(y("md","outline","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(Se,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Dışa Aktar"})]}),e.jsxs("button",{onClick:()=>{w(null),c(!0)},className:u(y("md","primary","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(we,{size:18}),e.jsx("span",{children:"Yeni Gider"})]})]})]})}),e.jsx("div",{className:k("none","sm","default","lg"),style:{overflow:"hidden"},children:re?e.jsx("div",{className:"p-12 text-center text-neutral-600",children:"Yükleniyor..."}):g.length===0?e.jsxs("div",{className:"p-12 text-center text-neutral-600",children:[e.jsx(je,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{className:"text-lg font-medium",children:"Gider kaydı bulunamadı"}),e.jsx("p",{className:"text-sm mt-2",children:"Yeni gider ekleyerek başlayın"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:b,children:"Tarih"}),e.jsx("th",{className:b,children:"Açıklama"}),e.jsx("th",{className:`${b} hidden md:table-cell`,children:"Kategori"}),e.jsx("th",{className:b,children:"Tutar"}),e.jsx("th",{className:`${b} hidden lg:table-cell`,children:"Ödeme"}),e.jsx("th",{className:`${b} hidden md:table-cell`,children:"Durum"}),e.jsx("th",{className:b,children:"İşlemler"})]})}),e.jsx("tbody",{children:g.map(a=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors",children:[e.jsx("td",{className:v,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-sm text-neutral-900",children:se(a.date)})]})}),e.jsx("td",{className:v,children:e.jsx("div",{className:"text-sm font-medium text-neutral-900",children:a.description})}),e.jsx("td",{className:`${v} hidden md:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.category})}),e.jsx("td",{className:v,children:e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:f(a.amount)})}),e.jsx("td",{className:`${v} hidden lg:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.paymentMethod})}),e.jsx("td",{className:`${v} hidden md:table-cell`,children:te(a.status)}),e.jsx("td",{className:v,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ee(a),className:u(y("sm","ghost","lg"),"p-2"),title:"Düzenle",children:e.jsx(De,{size:16})}),e.jsx("button",{onClick:()=>Z(a.id),className:u(y("sm","ghost","lg"),"p-2"),title:"Sil",children:e.jsx(Te,{size:16})})]})})]},a.id))})]})}),e.jsxs("div",{className:(O=(L=t)==null?void 0:L.pagination)==null?void 0:O.container,children:[e.jsxs("div",{className:(U=(R=t)==null?void 0:R.pagination)==null?void 0:U.info,children:["Sayfa ",j," / ",D]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(a=>Math.max(1,a-1)),disabled:j===1,className:u(y("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Önceki"}),e.jsx("button",{onClick:()=>F(a=>Math.min(D,a+1)),disabled:j===D,className:u(y("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Sonraki"})]})]})]})}),e.jsx($e,{open:l,onClose:()=>{c(!1),w(null)},onSaved:T,initial:Y})]})}export{Le as default};
