import{a as L,o as E,r as u,t as d,j as e}from"./react-vendor-DBHNAGPW.js";import{f,g as U}from"./index-C00KFl1S.js";import{F as O}from"./FormSkeleton-BLq7ANDw.js";import{am as $,F as B,U as K,f as D,u as _,D as G,ac as M,ap as Q,aO as V,a6 as H}from"./ui-vendor-CIs_GH3f.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const j="http://localhost:3000/api",X=[{value:0,label:"%0"},{value:1,label:"%1"},{value:8,label:"%8"},{value:10,label:"%10"},{value:20,label:"%20"}],se=()=>{const v=L(),{id:x}=E(),m=!!x,[N,p]=u.useState(!1),[T,S]=u.useState([]),[k,q]=u.useState([]),[a,r]=u.useState({quoteNumber:"",customerId:"",issueDate:new Date().toISOString().split("T")[0],validUntil:"",validityDays:30,notes:"",termsAndConditions:"",discountPercentage:0,status:"pending"}),[i,g]=u.useState([{id:"1",description:"",quantity:1,unitPrice:0,taxRate:20,total:0,taxAmount:0,grandTotal:0}]);u.useEffect(()=>{A(),C(),m&&I()},[x]),u.useEffect(()=>{if(a.issueDate&&a.validityDays>0){const t=new Date(a.issueDate),s=new Date(t);s.setDate(s.getDate()+a.validityDays),r(n=>({...n,validUntil:s.toISOString().split("T")[0]}))}},[a.issueDate,a.validityDays]);const A=async()=>{try{const t=await f.get(`${j}/customers`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});S(t.data.data||t.data||[])}catch(t){console.error("Failed to load customers:",t),d.error("Müşteriler yüklenemedi")}},C=async()=>{try{const t=await U.getAll();q(t.data.data||t.data||[])}catch(t){console.error("Failed to load equipments:",t)}},I=async()=>{try{p(!0);const s=(await f.get(`${j}/quotes/${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data;r({quoteNumber:s.quoteNumber,customerId:s.customerId,issueDate:s.issueDate.split("T")[0],validUntil:s.validUntil.split("T")[0],validityDays:s.validityDays||30,notes:s.notes||"",termsAndConditions:s.termsAndConditions||"",discountPercentage:s.discountPercentage||0,status:s.status}),g(s.items||[])}catch(t){console.error("Failed to load quote:",t),d.error("Teklif yüklenemedi")}finally{p(!1)}},F=()=>{const t={id:Date.now().toString(),description:"",quantity:1,unitPrice:0,taxRate:20,total:0,taxAmount:0,grandTotal:0};g([...i,t])},z=t=>{if(i.length===1){d.error("En az bir ürün olmalıdır");return}g(i.filter(s=>s.id!==t))},c=(t,s,n)=>{g(i.map(l=>{if(l.id===t){const o={...l,[s]:n};return o.total=o.quantity*o.unitPrice,o.taxAmount=o.total*(o.taxRate/100),o.grandTotal=o.total+o.taxAmount,o}return l}))},P=(t,s)=>{const n=k.find(l=>l.id===s);n&&(c(t,"description",n.name),c(t,"unitPrice",n.price),c(t,"equipmentId",s))},h=()=>i.reduce((t,s)=>t+s.total,0),y=()=>i.reduce((t,s)=>t+s.taxAmount,0),b=()=>h()*(a.discountPercentage/100),w=()=>{const t=h(),s=y(),n=b();return t+s-n},R=async t=>{var s,n;if(t.preventDefault(),!a.customerId){d.error("Lütfen müşteri seçin");return}if(!a.quoteNumber){d.error("Lütfen teklif numarası girin");return}if(!a.validUntil){d.error("Lütfen geçerlilik tarihi belirtin");return}if(i.some(l=>!l.description||l.quantity<=0||l.unitPrice<=0)){d.error("Lütfen tüm ürün bilgilerini doldurun");return}try{p(!0);const l={...a,customerId:parseInt(a.customerId),items:i,subtotal:h(),taxAmount:y(),discountAmount:b(),totalAmount:w()};m?(await f.put(`${j}/quotes/${x}`,l,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),d.success("Teklif güncellendi")):(await f.post(`${j}/quotes`,l,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),d.success("Teklif oluşturuldu")),v("/accounting?tab=offer")}catch(l){console.error("Failed to save quote:",l),d.error(((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.message)||"Teklif kaydedilemedi")}finally{p(!1)}};return N&&m?e.jsx(O,{}):e.jsx("div",{className:"min-h-screen bg-neutral-50 py-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>v("/accounting?tab=offer"),className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx($,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:m?"Teklif Düzenle":"Yeni Teklif Oluştur"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:"Teklif bilgilerini doldurun ve kaydedin"})]})]})}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(B,{size:20}),"Teklif Bilgileri"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Teklif Numarası *"}),e.jsx("input",{type:"text",value:a.quoteNumber,onChange:t=>r({...a,quoteNumber:t.target.value}),placeholder:"QUO-2025-001",className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2 flex items-center gap-2",children:[e.jsx(K,{size:16}),"Müşteri *"]}),e.jsxs("select",{value:a.customerId,onChange:t=>r({...a,customerId:t.target.value}),className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",required:!0,children:[e.jsx("option",{value:"",children:"Müşteri seçin..."}),T.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2 flex items-center gap-2",children:[e.jsx(D,{size:16}),"Düzenlenme Tarihi *"]}),e.jsx("input",{type:"date",value:a.issueDate,onChange:t=>r({...a,issueDate:t.target.value}),className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2 flex items-center gap-2",children:[e.jsx(_,{size:16}),"Geçerlilik Süresi (Gün)"]}),e.jsx("input",{type:"number",value:a.validityDays,onChange:t=>r({...a,validityDays:parseInt(t.target.value)||30}),placeholder:"30",min:"1",max:"365",className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900"}),e.jsx("p",{className:"text-xs text-neutral-600 mt-1",children:"Teklif kaç gün geçerli olacak?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2 flex items-center gap-2",children:[e.jsx(D,{size:16}),"Geçerlilik Bitiş Tarihi *"]}),e.jsx("input",{type:"date",value:a.validUntil,onChange:t=>r({...a,validUntil:t.target.value}),className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",required:!0}),e.jsx("p",{className:"text-xs text-neutral-600 mt-1",children:"Otomatik hesaplandı (yukarıdaki günden)"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Durum"}),e.jsxs("select",{value:a.status,onChange:t=>r({...a,status:t.target.value}),className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",children:[e.jsx("option",{value:"pending",children:"Beklemede"}),e.jsx("option",{value:"approved",children:"Onaylandı"}),e.jsx("option",{value:"rejected",children:"Reddedildi"}),e.jsx("option",{value:"converted",children:"Faturaya Dönüştü"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(G,{size:20}),"Ürün/Hizmetler"]}),e.jsxs("button",{type:"button",onClick:F,className:"px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(M,{size:16}),"Ürün Ekle"]})]}),e.jsx("div",{className:"space-y-3",children:i.map(t=>e.jsx("div",{className:"p-4 bg-neutral-50 rounded-xl space-y-3",children:e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-start",children:[e.jsxs("div",{className:"col-span-12 md:col-span-6",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Ekipman (Opsiyonel)"}),e.jsxs("select",{value:t.equipmentId||"",onChange:s=>P(t.id,parseInt(s.target.value)),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 text-sm",children:[e.jsx("option",{value:"",children:"Ekipman seçin veya manuel girin..."}),k.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.serialNumber]},s.id))]})]}),e.jsxs("div",{className:"col-span-12 md:col-span-6",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Açıklama *"}),e.jsx("input",{type:"text",value:t.description,onChange:s=>c(t.id,"description",s.target.value),placeholder:"Ürün/Hizmet açıklaması",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 text-sm",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Miktar *"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>c(t.id,"quantity",parseFloat(s.target.value)||0),placeholder:"0",min:"0",step:"0.01",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 text-sm",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Birim Fiyat *"}),e.jsx("input",{type:"number",value:t.unitPrice,onChange:s=>c(t.id,"unitPrice",parseFloat(s.target.value)||0),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 text-sm",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"KDV Oranı"}),e.jsx("select",{value:t.taxRate,onChange:s=>c(t.id,"taxRate",parseInt(s.target.value)),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 text-sm",children:X.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Tutar"}),e.jsxs("div",{className:"px-3 py-2 bg-neutral-100 rounded-lg text-sm font-medium text-neutral-900",children:["₺",t.total.toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"KDV"}),e.jsxs("div",{className:"px-3 py-2 bg-neutral-100 rounded-lg text-sm font-medium text-neutral-700",children:["₺",t.taxAmount.toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"col-span-6 md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-neutral-600 mb-1",children:"Toplam"}),e.jsxs("div",{className:"px-3 py-2 bg-neutral-900 text-white rounded-lg text-sm font-bold",children:["₺",t.grandTotal.toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"col-span-12 md:col-span-1 flex md:items-end md:justify-end",children:e.jsx("button",{type:"button",onClick:()=>z(t.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors self-end",disabled:i.length===1,title:"Ürünü Kaldır",children:e.jsx(Q,{size:18})})})]})},t.id))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-neutral-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2 flex items-center gap-2",children:[e.jsx(V,{size:16}),"İndirim Oranı"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:a.discountPercentage,onChange:t=>r({...a,discountPercentage:parseFloat(t.target.value)||0}),placeholder:"0",min:"0",max:"100",step:"0.01",className:"flex-1 px-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900"}),e.jsx("div",{className:"px-4 py-2 bg-neutral-100 rounded-xl font-medium",children:"%"})]}),a.discountPercentage>0&&e.jsxs("p",{className:"text-xs text-neutral-600 mt-1",children:["İndirim Tutarı: ₺",b().toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Ara Toplam:"}),e.jsxs("span",{className:"font-medium",children:["₺",h().toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam KDV:"}),e.jsxs("span",{className:"font-medium",children:["₺",y().toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),a.discountPercentage>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["İndirim (",a.discountPercentage,"%):"]}),e.jsxs("span",{className:"font-medium",children:["-₺",b().toLocaleString("tr-TR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-neutral-200",children:[e.jsx("span",{children:"Genel Toplam:"}),e.jsxs("span",{className:"text-neutral-900",children:["₺",w().toLocaleString("tr-TR",{minimumFractionDigits:2})]})]})]})]})})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Notlar"}),e.jsx("textarea",{value:a.notes,onChange:t=>r({...a,notes:t.target.value}),placeholder:"Teklif ile ilgili notlar (opsiyonel)",rows:6,className:"w-full px-4 py-3 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900 resize-none"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Şartlar ve Koşullar"}),e.jsx("textarea",{value:a.termsAndConditions,onChange:t=>r({...a,termsAndConditions:t.target.value}),placeholder:"Ödeme koşulları, teslimat şartları vb. (opsiyonel)",rows:6,className:"w-full px-4 py-3 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900 resize-none"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>v("/accounting?tab=offer"),className:"px-6 py-3 border border-neutral-300 text-neutral-700 rounded-xl hover:bg-neutral-50 transition-colors",children:"İptal"}),e.jsxs("button",{type:"submit",disabled:N,className:"px-6 py-3 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(H,{size:18}),N?"Kaydediliyor...":m?"Güncelle":"Kaydet"]})]})]})]})})};export{se as default};
