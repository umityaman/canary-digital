import{r,j as e,t as b}from"./react-vendor-DBHNAGPW.js";import{d as se}from"./index-C00KFl1S.js";import{c as u,D as s,i as h,b as j,a as v,s as ce,d as oe}from"./index-C5wiI25D.js";import{X as me,v as ue,D as xe,F as de,o as he,a0 as pe,ac as ge,f as je,a5 as Ne,ap as fe}from"./ui-vendor-CIs_GH3f.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const ye=["Ekipman Kiralama","Hizmet Bedeli","Ürün Satışı","Danışmanlık","Eğitim","Diğer"],ve=["Nakit","Banka Transferi","Kredi Kartı","Çek","Senet"],be=[{value:"received",label:"Alındı"},{value:"pending",label:"Beklemede"},{value:"cancelled",label:"İptal"}];function ke({open:p,onClose:k,onSaved:le,initial:d}){var Y,S,_,D,R,C,ne,$,re,g,I,T,z,H,q,U,X,J,M,Q,E,V,W,Z,ee,N,ae,te,F,K,A,G,B,P,a,x,m,n;const[l,o]=r.useState({description:"",amount:0,category:"Ekipman Kiralama",date:new Date().toISOString().split("T")[0],status:"received",paymentMethod:"Nakit",notes:""}),[L,w]=r.useState(!1);r.useEffect(()=>{o(d?{...d,date:d.date.split("T")[0]}:{description:"",amount:0,category:"Ekipman Kiralama",date:new Date().toISOString().split("T")[0],status:"received",paymentMethod:"Nakit",notes:""})},[d,p]);const O=async t=>{var i,c;if(t.preventDefault(),!l.description||l.amount<=0){b.error("Lütfen zorunlu alanları doldurun");return}w(!0);try{d!=null&&d.id?(await se.updateIncome(d.id,l),b.success("Gelir güncellendi")):(await se.createIncome(l),b.success("Gelir kaydedildi")),le(),k()}catch(ie){console.error("Income save error:",ie),b.error(((c=(i=ie.response)==null?void 0:i.data)==null?void 0:c.message)||ie.message||"Bir hata oluştu")}finally{w(!1)}};return p?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:u(v("lg","none","default","xl"),"w-full max-w-2xl max-h-[90vh] overflow-y-auto"),children:[e.jsxs("div",{className:u("sticky top-0 bg-white border-b border-neutral-200",(S=(Y=s)==null?void 0:Y.spacing)==null?void 0:S.padding.md,"flex items-center justify-between"),children:[e.jsx("h2",{className:`${(D=(_=s)==null?void 0:_.typography)==null?void 0:D.h2} ${(C=(R=s)==null?void 0:R.colors)==null?void 0:C.text.primary}`,children:d?"Gelir Düzenle":"Yeni Gelir"}),e.jsx("button",{onClick:k,className:`${($=(ne=s)==null?void 0:ne.colors)==null?void 0:$.text.muted} hover:text-neutral-600 transition-colors`,children:e.jsx(me,{size:24})})]}),e.jsxs("form",{onSubmit:O,className:u((g=(re=s)==null?void 0:re.spacing)==null?void 0:g.padding.md,"space-y-4"),children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(T=(I=s)==null?void 0:I.typography)==null?void 0:T.body.sm} font-medium ${(H=(z=s)==null?void 0:z.colors)==null?void 0:H.text.secondary} mb-2`,children:"Açıklama *"}),e.jsx("textarea",{value:l.description,onChange:t=>o({...l,description:t.target.value}),className:h("md","default",void 0,"md"),rows:3,placeholder:"Gelir açıklaması...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(U=(q=s)==null?void 0:q.typography)==null?void 0:U.body.sm} font-medium ${(J=(X=s)==null?void 0:X.colors)==null?void 0:J.text.secondary} mb-2`,children:"Tutar (₺) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.amount,onChange:t=>o({...l,amount:parseFloat(t.target.value)}),className:h("md","default",void 0,"md"),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(Q=(M=s)==null?void 0:M.typography)==null?void 0:Q.body.sm} font-medium ${(V=(E=s)==null?void 0:E.colors)==null?void 0:V.text.secondary} mb-2`,children:"Kategori *"}),e.jsx("select",{value:l.category,onChange:t=>o({...l,category:t.target.value}),className:h("md","default",void 0,"md"),children:ye.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(Z=(W=s)==null?void 0:W.typography)==null?void 0:Z.body.sm} font-medium ${(N=(ee=s)==null?void 0:ee.colors)==null?void 0:N.text.secondary} mb-2`,children:"Tarih *"}),e.jsx("input",{type:"date",value:l.date,onChange:t=>o({...l,date:t.target.value}),className:h("md","default",void 0,"md"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(te=(ae=s)==null?void 0:ae.typography)==null?void 0:te.body.sm} font-medium ${(K=(F=s)==null?void 0:F.colors)==null?void 0:K.text.secondary} mb-2`,children:"Ödeme Yöntemi *"}),e.jsx("select",{value:l.paymentMethod,onChange:t=>o({...l,paymentMethod:t.target.value}),className:h("md","default",void 0,"md"),children:ve.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(G=(A=s)==null?void 0:A.typography)==null?void 0:G.body.sm} font-medium ${(P=(B=s)==null?void 0:B.colors)==null?void 0:P.text.secondary} mb-2`,children:"Durum *"}),e.jsx("select",{value:l.status,onChange:t=>o({...l,status:t.target.value}),className:h("md","default",void 0,"md"),children:be.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(x=(a=s)==null?void 0:a.typography)==null?void 0:x.body.sm} font-medium ${(n=(m=s)==null?void 0:m.colors)==null?void 0:n.text.secondary} mb-2`,children:"Notlar"}),e.jsx("textarea",{value:l.notes,onChange:t=>o({...l,notes:t.target.value}),className:h("md","default",void 0,"md"),rows:2,placeholder:"Ek notlar..."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-neutral-200",children:[e.jsx("button",{type:"button",onClick:k,className:j("md","outline","lg"),children:"İptal"}),e.jsx("button",{type:"submit",disabled:L,className:u(j("md","primary","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:L?"Kaydediliyor...":d?"Güncelle":"Kaydet"})]})]})]})}):null}const f="px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase tracking-wider bg-neutral-50",y="px-6 py-4 text-sm text-neutral-900";function $e(){var F,K,A,G,B,P;const[p,k]=r.useState([]),[le,d]=r.useState(!1),[l,o]=r.useState(!1),[L,w]=r.useState(null),[O,Y]=r.useState(""),[S,_]=r.useState(""),[D,R]=r.useState(""),[C,ne]=r.useState(""),[$,re]=r.useState(""),[g,I]=r.useState(1),[T,z]=r.useState(1),H=10,[q,U]=r.useState(0),[X,J]=r.useState(0),[M,Q]=r.useState([]);r.useEffect(()=>{E(),V()},[g,S,D,C,$]);const E=async()=>{var a,x,m;d(!0);try{const n=await se.getIncomes({page:g,limit:H,category:S||void 0,status:D||void 0,startDate:C||void 0,endDate:$||void 0,search:O||void 0});k(((a=n==null?void 0:n.data)==null?void 0:a.data)||[]),z(((m=(x=n==null?void 0:n.data)==null?void 0:x.pagination)==null?void 0:m.totalPages)||1)}catch(n){console.warn("Failed to load incomes:",n),k([]),z(1)}finally{d(!1)}},V=async()=>{try{const a=p.reduce((i,c)=>i+c.amount,0);U(a);const x=new Date().getMonth(),m=p.filter(i=>new Date(i.date).getMonth()===x).reduce((i,c)=>i+c.amount,0);J(m);const n=new Map;p.forEach(i=>{const c=n.get(i.category)||{total:0,count:0};n.set(i.category,{total:c.total+i.amount,count:c.count+1})});const t=Array.from(n.entries()).map(([i,c])=>({category:i,total:c.total,count:c.count,percentage:c.total/a*100}));Q(t.sort((i,c)=>c.total-i.total))}catch(a){console.error("Stats calculation error:",a)}},W=async a=>{var x,m;if(confirm("Bu gelir kaydını silmek istediğinizden emin misiniz?"))try{await se.deleteIncome(a),b.success("Gelir kaydı silindi"),E()}catch(n){console.error("Failed to delete income:",n),b.error("Silme işlemi başarısız: "+(((m=(x=n.response)==null?void 0:x.data)==null?void 0:m.message)||n.message))}},Z=a=>{w(a),o(!0)},ee=()=>{b.success("Dışa aktarma başlatıldı")},N=a=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),ae=a=>new Date(a).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric"}),te=a=>{const m=oe({received:"paid",pending:"partial",cancelled:"overdue"}[a]||a,"invoice","sm","solid");return e.jsx("span",{className:m.className,children:m.label})};return e.jsxs("div",{className:"space-y-6 w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:v("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:ce("primary"),children:e.jsx(ue,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Bu Ay"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:N(X)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Aylık Gelir"})]}),e.jsxs("div",{className:v("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:ce("primary"),children:e.jsx(xe,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Toplam"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:N(q)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Toplam Gelir"})]}),e.jsxs("div",{className:v("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:ce("primary"),children:e.jsx(de,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Kayıt"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:p.length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Gelir Kaydı"})]})]}),M.length>0&&e.jsxs("div",{className:v("sm","md","default","lg"),children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Kategori Dağılımı"}),e.jsx("div",{className:"space-y-3",children:M.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:a.category}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-neutral-500",children:[a.count," kayıt"]}),e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:N(a.total)})]})]}),e.jsx("div",{className:"w-full bg-neutral-100 rounded-full h-2",children:e.jsx("div",{className:"bg-neutral-900 h-2 rounded-full transition-all",style:{width:`${a.percentage}%`}})})]},a.category))})]}),e.jsx("div",{className:v("sm","none","default","lg"),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${(K=(F=s)==null?void 0:F.colors)==null?void 0:K.text.muted}`,size:18}),e.jsx("input",{type:"text",placeholder:"Gelir ara...",value:O,onChange:a=>Y(a.target.value),className:u(h("md","default",void 0,"md"),"pl-10")})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:S,onChange:a=>_(a.target.value),className:u(h("md","default",void 0,"md"),"flex-1 min-w-[150px] max-w-[200px]"),children:[e.jsx("option",{value:"",children:"Tüm Kategoriler"}),e.jsx("option",{value:"Ekipman Kiralama",children:"Ekipman Kiralama"}),e.jsx("option",{value:"Hizmet Bedeli",children:"Hizmet Bedeli"}),e.jsx("option",{value:"Danışmanlık",children:"Danışmanlık"}),e.jsx("option",{value:"Eğitim",children:"Eğitim"}),e.jsx("option",{value:"Diğer",children:"Diğer"})]}),e.jsxs("select",{value:D,onChange:a=>R(a.target.value),className:u(h("md","default",void 0,"md"),"flex-1 min-w-[130px]"),children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"received",children:"Alındı"}),e.jsx("option",{value:"pending",children:"Beklemede"}),e.jsx("option",{value:"cancelled",children:"İptal"})]}),e.jsxs("button",{onClick:ee,className:u(j("md","outline","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(pe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Dışa Aktar"})]}),e.jsxs("button",{onClick:()=>{w(null),o(!0)},className:u(j("md","primary","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(ge,{size:18}),e.jsx("span",{children:"Yeni Gelir"})]})]})]})}),e.jsx("div",{className:v("none","sm","default","lg"),style:{overflow:"hidden"},children:le?e.jsx("div",{className:"p-12 text-center text-neutral-600",children:"Yükleniyor..."}):p.length===0?e.jsxs("div",{className:"p-12 text-center text-neutral-600",children:[e.jsx(de,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{className:"text-lg font-medium",children:"Gelir kaydı bulunamadı"}),e.jsx("p",{className:"text-sm mt-2",children:"Yeni gelir ekleyerek başlayın"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:f,children:"Tarih"}),e.jsx("th",{className:f,children:"Açıklama"}),e.jsx("th",{className:`${f} hidden md:table-cell`,children:"Kategori"}),e.jsx("th",{className:f,children:"Tutar"}),e.jsx("th",{className:`${f} hidden lg:table-cell`,children:"Ödeme"}),e.jsx("th",{className:`${f} hidden md:table-cell`,children:"Durum"}),e.jsx("th",{className:f,children:"İşlemler"})]})}),e.jsx("tbody",{children:p.map(a=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors",children:[e.jsx("td",{className:y,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-sm text-neutral-900",children:ae(a.date)})]})}),e.jsx("td",{className:y,children:e.jsx("div",{className:"text-sm font-medium text-neutral-900",children:a.description})}),e.jsx("td",{className:`${y} hidden md:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.category})}),e.jsx("td",{className:y,children:e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:N(a.amount)})}),e.jsx("td",{className:`${y} hidden lg:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.paymentMethod})}),e.jsx("td",{className:`${y} hidden md:table-cell`,children:te(a.status)}),e.jsx("td",{className:y,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(a),className:u(j("sm","ghost","lg"),"p-2"),title:"Düzenle",children:e.jsx(Ne,{size:16})}),e.jsx("button",{onClick:()=>W(a.id),className:u(j("sm","ghost","lg"),"p-2"),title:"Sil",children:e.jsx(fe,{size:16})})]})})]},a.id))})]})}),e.jsxs("div",{className:(G=(A=s)==null?void 0:A.pagination)==null?void 0:G.container,children:[e.jsxs("div",{className:(P=(B=s)==null?void 0:B.pagination)==null?void 0:P.info,children:["Sayfa ",g," / ",T]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(a=>Math.max(1,a-1)),disabled:g===1,className:u(j("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Önceki"}),e.jsx("button",{onClick:()=>I(a=>Math.min(T,a+1)),disabled:g===T,className:u(j("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Sonraki"})]})]})]})}),e.jsx(ke,{open:l,onClose:()=>{o(!1),w(null)},onSaved:E,initial:L})]})}export{$e as default};
