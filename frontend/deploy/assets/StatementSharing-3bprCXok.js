import{r as a,j as e,t as l}from"./react-vendor-DBHNAGPW.js";import{f as h}from"./index-C00KFl1S.js";import{F as I,Q as $,aN as A,v as P,w as V,a0 as B,an as _,u as q,U as J}from"./ui-vendor-CIs_GH3f.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const p="http://localhost:3000",b=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),j={generate:async n=>(await h.post(`${p}/api/statements/generate`,n,b())).data,downloadPDF:async n=>(await h.post(`${p}/api/statements/pdf`,n,{...b(),responseType:"blob"})).data,downloadExcel:async n=>(await h.post(`${p}/api/statements/excel`,n,{...b(),responseType:"blob"})).data,share:async n=>(await h.post(`${p}/api/statements/share`,n,b())).data,getHistory:async()=>(await h.get(`${p}/api/statements/history`,b())).data},re=()=>{const[n,m]=a.useState([]),[i,L]=a.useState(null),[c,v]=a.useState(""),[d,w]=a.useState(""),[r,O]=a.useState(null),[g,f]=a.useState(!1),[k,S]=a.useState(!1),[E,R]=a.useState([]),[z,U]=a.useState("pdf"),[N,G]=a.useState(!0),[y,M]=a.useState(!1),[C,H]=a.useState("Sayın müşterimiz, hesap özet ekstreniz ektedir.");a.useEffect(()=>{W(),D();const t=new Date,s=new Date;s.setDate(s.getDate()-30),w(t.toISOString().split("T")[0]),v(s.toISOString().split("T")[0])},[]);const W=async()=>{try{const s=await(await fetch("undefined/api/customers",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();m(s)}catch(t){console.error("Error loading customers:",t)}},D=async()=>{try{const t=await j.getHistory();R(t)}catch(t){console.error("Error loading history:",t)}},Y=async()=>{if(!i||!c||!d){l.error("Lütfen müşteri ve tarih aralığı seçin");return}try{f(!0);const t={customerId:i,startDate:c,endDate:d,includePayments:!0,includeInvoices:!0,includeOrders:!0},s=await j.generate(t);O(s),l.success("Ekstre oluşturuldu")}catch(t){console.error("Error generating statement:",t),l.error("Ekstre oluşturulamadı")}finally{f(!1)}},F=async t=>{if(!i||!c||!d){l.error("Lütfen ekstre oluşturun");return}try{f(!0);const s={customerId:i,startDate:c,endDate:d,includePayments:!0,includeInvoices:!0,includeOrders:!0},Q=t==="pdf"?await j.downloadPDF(s):await j.downloadExcel(s),T=window.URL.createObjectURL(Q),u=document.createElement("a");u.href=T,u.download=`ekstre-${i}-${c}-${d}.${t==="pdf"?"pdf":"xlsx"}`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(T),document.body.removeChild(u),l.success(`Ekstre ${t.toUpperCase()} olarak indirildi`)}catch(s){console.error("Error downloading statement:",s),l.error("İndirme başarısız")}finally{f(!1)}},K=async()=>{if(!i||!c||!d){l.error("Lütfen ekstre oluşturun");return}if(!N&&!y){l.error("En az bir gönderim yöntemi seçin");return}try{S(!0);const t=await j.share({customerId:i,startDate:c,endDate:d,format:z,sendEmail:N,sendWhatsApp:y,message:C,includePayments:!0,includeInvoices:!0,includeOrders:!0});t.success?(l.success("Ekstre başarıyla gönderildi!"),D()):l.error(t.message||"Gönderim başarısız")}catch(t){console.error("Error sharing statement:",t),l.error("Gönderim başarısız")}finally{S(!1)}},o=t=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(t),x=t=>new Date(t).toLocaleDateString("tr-TR");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-900",children:"Ekstre Paylaşımı"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:"Müşterilere hesap ekstresi gönderin"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-neutral-200 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-4",children:"Ekstre Oluştur"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Müşteri ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:i||"",onChange:t=>L(Number(t.target.value)),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",children:[e.jsx("option",{value:"",children:"Müşteri Seçin"}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Başlangıç Tarihi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:c,onChange:t=>v(t.target.value),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:["Bitiş Tarihi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:d,onChange:t=>w(t.target.value),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900"})]})]}),e.jsx("button",{onClick:Y,disabled:g||!i||!c||!d,className:"w-full bg-neutral-900 text-white py-3 rounded-xl hover:bg-neutral-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Oluşturuluyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:20}),"Ekstre Oluştur"]})})]}),r&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-neutral-200 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between pb-4 border-b border-neutral-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-neutral-900",children:r.customer.name}),r.customer.email&&e.jsxs("p",{className:"text-sm text-neutral-600 flex items-center gap-2 mt-1",children:[e.jsx($,{size:14}),r.customer.email]}),r.customer.phone&&e.jsxs("p",{className:"text-sm text-neutral-600 flex items-center gap-2 mt-1",children:[e.jsx(A,{size:14}),r.customer.phone]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Dönem"}),e.jsxs("p",{className:"font-semibold text-neutral-900",children:[x(r.period.start)," - ",x(r.period.end)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-neutral-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-blue-900",children:"Açılış Bakiyesi"}),e.jsx(P,{className:"text-blue-600",size:16})]}),e.jsx("p",{className:"text-xl font-bold text-blue-900",children:o(r.summary.openingBalance)})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-green-900",children:"Toplam Faturalar"}),e.jsx(I,{className:"text-green-600",size:16})]}),e.jsx("p",{className:"text-xl font-bold text-green-900",children:o(r.summary.totalInvoices)})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-orange-900",children:"Toplam Ödemeler"}),e.jsx(V,{className:"text-orange-600",size:16})]}),e.jsx("p",{className:"text-xl font-bold text-orange-900",children:o(r.summary.totalPayments)})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-purple-900",children:"Kapanış Bakiyesi"}),e.jsx(P,{className:"text-purple-600",size:16})]}),e.jsx("p",{className:"text-xl font-bold text-purple-900",children:o(r.summary.closingBalance)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-neutral-900 mb-3",children:"İşlemler"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-200",children:[e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-neutral-700",children:"Tarih"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-neutral-700",children:"Açıklama"}),e.jsx("th",{className:"text-left py-3 px-2 text-sm font-medium text-neutral-700",children:"Referans"}),e.jsx("th",{className:"text-right py-3 px-2 text-sm font-medium text-neutral-700",children:"Borç"}),e.jsx("th",{className:"text-right py-3 px-2 text-sm font-medium text-neutral-700",children:"Alacak"}),e.jsx("th",{className:"text-right py-3 px-2 text-sm font-medium text-neutral-700",children:"Bakiye"})]})}),e.jsx("tbody",{children:r.transactions.map((t,s)=>e.jsxs("tr",{className:"border-b border-neutral-100 hover:bg-neutral-50",children:[e.jsx("td",{className:"py-3 px-2 text-sm text-neutral-600",children:x(t.date)}),e.jsx("td",{className:"py-3 px-2 text-sm text-neutral-900",children:t.description}),e.jsx("td",{className:"py-3 px-2 text-sm text-neutral-600",children:t.reference||"-"}),e.jsx("td",{className:"py-3 px-2 text-sm text-right text-red-600",children:t.debit>0?o(t.debit):"-"}),e.jsx("td",{className:"py-3 px-2 text-sm text-right text-green-600",children:t.credit>0?o(t.credit):"-"}),e.jsx("td",{className:"py-3 px-2 text-sm text-right font-semibold text-neutral-900",children:o(t.balance)})]},s))})]})})]}),e.jsxs("div",{className:"pt-4 border-t border-neutral-200 space-y-4",children:[e.jsx("h4",{className:"font-semibold text-neutral-900",children:"Ekstre İşlemleri"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>F("pdf"),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-red-600 text-white py-3 rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50",children:[e.jsx(B,{size:20}),"PDF İndir"]}),e.jsxs("button",{onClick:()=>F("excel"),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-green-600 text-white py-3 rounded-xl hover:bg-green-700 transition-colors disabled:opacity-50",children:[e.jsx(B,{size:20}),"Excel İndir"]})]}),e.jsxs("div",{className:"bg-neutral-50 rounded-xl p-4 space-y-4",children:[e.jsx("h5",{className:"font-medium text-neutral-900",children:"Müşteriye Gönder"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Format"}),e.jsxs("select",{value:z,onChange:t=>U(t.target.value),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",children:[e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"excel",children:"Excel"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Gönderim Yöntemi"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:t=>G(t.target.checked),className:"w-4 h-4 text-neutral-900 rounded"}),e.jsx($,{size:16}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>M(t.target.checked),className:"w-4 h-4 text-neutral-900 rounded"}),e.jsx(A,{size:16}),e.jsx("span",{className:"text-sm",children:"WhatsApp"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Mesaj"}),e.jsx("textarea",{value:C,onChange:t=>H(t.target.value),rows:3,className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900",placeholder:"Müşteriye gönderilecek mesaj..."})]}),e.jsx("button",{onClick:K,disabled:k||!N&&!y,className:"w-full flex items-center justify-center gap-2 bg-neutral-900 text-white py-3 rounded-xl hover:bg-neutral-800 transition-colors disabled:opacity-50",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Gönderiliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:20}),"Gönder"]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-neutral-200",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-4",children:"Gönderim Geçmişi"}),E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"mx-auto text-neutral-400 mb-3",size:40}),e.jsx("p",{className:"text-neutral-600",children:"Henüz gönderim yapılmamış"})]}):e.jsx("div",{className:"space-y-3",children:E.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-neutral-50 rounded-xl hover:bg-neutral-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-neutral-900 rounded-lg flex items-center justify-center",children:e.jsx(J,{className:"text-white",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:t.customerName}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[x(t.startDate)," - ",x(t.endDate)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"px-3 py-1 bg-blue-50 text-blue-700 text-xs rounded-full border border-neutral-200",children:[t.format.toUpperCase()," • ",t.sentVia]}),e.jsx("p",{className:"text-xs text-neutral-600 mt-1",children:x(t.sentAt)})]})]},t.id))})]})]})};export{re as default};
