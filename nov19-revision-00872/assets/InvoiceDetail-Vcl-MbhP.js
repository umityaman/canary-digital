import{o as G,a as L,r as i,z as l,j as e,v as q}from"./react-vendor-DBHNAGPW.js";import{i as b}from"./index-BB04Wo6n.js";import{D as R}from"./DetailSkeleton-ZBWuwSwT.js";import{F as z,am as A,h as V,a0 as _,a1 as H,Q as T,a5 as Y,ap as O,f as Q,u as X,a2 as J,ab as U,a as W,A as Z,C as ee}from"./ui-vendor-Vc_pfhQB.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";function ie(){var D;const{id:o}=G(),m=L(),[t,C]=i.useState(null),[F,g]=i.useState(!0),[P,x]=i.useState(!1),[f,u]=i.useState(""),[N,h]=i.useState("cash"),[v,p]=i.useState(""),[j,y]=i.useState(!1);i.useEffect(()=>{o&&w()},[o]);const w=async()=>{var s,n;try{g(!0),console.log("ðŸ” Loading invoice:",o);const a=await b.getById(Number(o));console.log("âœ… Invoice loaded:",a.data),C(a.data.data||a.data)}catch(a){console.error("âŒ Failed to load invoice:",a),l.error("Fatura yÃ¼klenemedi: "+(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||a.message)),setTimeout(()=>m("/accounting?tab=invoice"),2e3)}finally{g(!1)}},S=async()=>{var s,n;if(t&&confirm(`${t.invoiceNumber} numaralÄ± faturayÄ± silmek istediÄŸinizden emin misiniz?`))try{await b.delete(t.id),l.success("Fatura baÅŸarÄ±yla silindi"),m("/accounting?tab=invoice")}catch(a){console.error("Failed to delete invoice:",a),l.error("Fatura silinemedi: "+(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||a.message))}},M=()=>{window.print()},K=async()=>{try{l.success("PDF indirme Ã¶zelliÄŸi yakÄ±nda eklenecek")}catch{l.error("PDF indirilemedi")}},B=async()=>{try{l.success("E-posta gÃ¶nderme Ã¶zelliÄŸi yakÄ±nda eklenecek")}catch{l.error("E-posta gÃ¶nderilemedi")}},I=async()=>{try{navigator.share?await navigator.share({title:`Fatura ${t==null?void 0:t.invoiceNumber}`,text:`${t==null?void 0:t.customer.name} - ${r((t==null?void 0:t.grandTotal)||0)}`,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),l.success("Link kopyalandÄ±"))}catch(s){console.error("Share failed:",s)}},r=s=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),d=s=>new Date(s).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}),$=async()=>{var n,a;if(!t)return;const s=parseFloat(f);if(isNaN(s)||s<=0){l.error("GeÃ§erli bir tutar girin");return}if(s>t.remainingAmount){l.error(`Ã–deme tutarÄ± kalan tutardan (${r(t.remainingAmount)}) fazla olamaz`);return}try{y(!0);const c=await b.recordPayment(t.id,{amount:s,paymentDate:new Date().toISOString(),paymentMethod:N,notes:v||void 0});l.success("Ã–deme baÅŸarÄ±yla kaydedildi"),x(!1),u(""),h("cash"),p(""),await w()}catch(c){console.error("Failed to save payment:",c),l.error("Ã–deme kaydedilemedi: "+(((a=(n=c.response)==null?void 0:n.data)==null?void 0:a.message)||c.message))}finally{y(!1)}},E=s=>{const n={draft:{label:"Taslak",color:"bg-neutral-100 text-gray-800",icon:z},sent:{label:"GÃ¶nderildi",color:"bg-blue-100 text-blue-800",icon:T},paid:{label:"Ã–dendi",color:"bg-green-100 text-green-800",icon:ee},overdue:{label:"Vadesi GeÃ§ti",color:"bg-red-100 text-red-800",icon:Z},cancelled:{label:"Ä°ptal",color:"bg-neutral-100 text-gray-800",icon:W}},a=n[s]||n.draft,c=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${a.color}`,children:[e.jsx(c,{size:14}),a.label]})};if(F)return e.jsx(R,{});if(!t)return e.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{size:48,className:"text-neutral-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Fatura bulunamadÄ±"}),e.jsx("p",{className:"text-neutral-600 mb-4",children:"Bu fatura silinmiÅŸ veya mevcut deÄŸil."}),e.jsxs(q,{to:"/accounting?tab=invoice",className:"inline-flex items-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors",children:[e.jsx(A,{size:18}),"Fatura Listesine DÃ¶n"]})]})});const k=t.grandTotal>0?Math.round(t.paidAmount/t.grandTotal*100):0;return e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 print:hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/accounting?tab=invoice"),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(A,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:t.invoiceNumber}),e.jsx("p",{className:"text-sm text-neutral-600",children:t.customer.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"PaylaÅŸ",children:e.jsx(V,{size:20})}),e.jsx("button",{onClick:K,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"PDF Ä°ndir",children:e.jsx(_,{size:20})}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"YazdÄ±r",children:e.jsx(H,{size:20})}),e.jsx("button",{onClick:B,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"E-posta GÃ¶nder",children:e.jsx(T,{size:20})}),e.jsxs("button",{onClick:()=>m(`/accounting/invoice/${t.id}/edit`),className:"px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors flex items-center gap-2",children:[e.jsx(Y,{size:18}),"DÃ¼zenle"]}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-red-100 text-red-600 rounded-lg transition-colors",title:"Sil",children:e.jsx(O,{size:20})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Fatura Bilgileri"}),E(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-600 mb-1",children:[e.jsx(Q,{size:16}),"Fatura Tarihi"]}),e.jsx("p",{className:"font-medium text-neutral-900",children:d(t.invoiceDate)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-600 mb-1",children:[e.jsx(X,{size:16}),"Vade Tarihi"]}),e.jsx("p",{className:"font-medium text-neutral-900",children:d(t.dueDate)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(J,{size:20}),"MÃ¼ÅŸteri Bilgileri"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Ad/Ãœnvan"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.name})]}),t.customer.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"E-posta"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.email})]}),t.customer.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Telefon"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.phone})]}),t.customer.taxNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Vergi No"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.taxNumber})]}),t.customer.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Adres"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200",children:e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Kalemler"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-700 uppercase",children:"AÃ§Ä±klama"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Miktar"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Birim Fiyat"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Toplam"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:(D=t.items)==null?void 0:D.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.description}),s.equipment&&e.jsxs("p",{className:"text-sm text-neutral-600",children:[s.equipment.name,s.equipment.serialNumber&&` (${s.equipment.serialNumber})`]})]})}),e.jsx("td",{className:"px-6 py-4 text-right text-neutral-900",children:s.quantity}),e.jsx("td",{className:"px-6 py-4 text-right text-neutral-900",children:r(s.unitPrice)}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-neutral-900",children:r(s.total)})]},s.id))})]})}),e.jsx("div",{className:"p-6 bg-neutral-50 border-t border-neutral-200",children:e.jsxs("div",{className:"max-w-sm ml-auto space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"Ara Toplam"}),e.jsx("span",{className:"font-medium",children:r(t.subtotal)})]}),t.discountAmount!=null&&t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"Ä°ndirim"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",r(t.discountAmount)]})]}),e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"KDV"}),e.jsx("span",{className:"font-medium",children:r(t.taxAmount)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-neutral-900 pt-2 border-t border-neutral-300",children:[e.jsx("span",{children:"Genel Toplam"}),e.jsx("span",{children:r(t.grandTotal)})]})]})})]}),t.notes&&e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 mb-3",children:"Notlar"}),e.jsx("p",{className:"text-neutral-700 whitespace-pre-wrap",children:t.notes})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:20}),"Ã–deme Durumu"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-neutral-600 mb-2",children:[e.jsx("span",{children:"Ã–denen"}),e.jsxs("span",{children:[k,"%"]})]}),e.jsx("div",{className:"w-full bg-neutral-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${k}%`}})})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-neutral-200",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-700",children:"Toplam Tutar"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:r(t.grandTotal)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-700",children:"Ã–denen"}),e.jsx("span",{className:"font-semibold text-green-600",children:r(t.paidAmount)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-neutral-200",children:[e.jsx("span",{className:"text-neutral-900 font-medium",children:"Kalan"}),e.jsx("span",{className:"font-bold text-neutral-900",children:r(t.remainingAmount)})]})]}),t.remainingAmount>0&&e.jsx("button",{onClick:()=>x(!0),className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors",children:"Ã–deme Kaydet"})]})]}),t.paymentHistory&&t.paymentHistory.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Ã–deme GeÃ§miÅŸi"}),e.jsx("div",{className:"space-y-3",children:t.paymentHistory.map(s=>e.jsxs("div",{className:"pb-3 border-b border-neutral-200 last:border-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-neutral-900",children:r(s.amount)}),e.jsx("span",{className:"text-xs text-neutral-600",children:d(s.paymentDate)})]}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.paymentMethod}),s.notes&&e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:s.notes})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Ä°ÅŸlem GeÃ§miÅŸi"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Fatura oluÅŸturuldu"}),e.jsx("p",{className:"text-xs text-neutral-600",children:d(t.createdAt)}),t.createdBy&&e.jsx("p",{className:"text-xs text-neutral-500",children:t.createdBy.name})]})]}),t.payments&&t.payments.length>0&&t.payments.sort((s,n)=>new Date(n.paymentDate).getTime()-new Date(s.paymentDate).getTime()).map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-neutral-900",children:["Ã–deme alÄ±ndÄ± - ",r(s.amount)]}),e.jsxs("p",{className:"text-xs text-neutral-600",children:[d(s.paymentDate)," â€¢ ",s.paymentMethod==="cash"?"Nakit":s.paymentMethod==="bank_transfer"?"Banka Transferi":s.paymentMethod==="credit_card"?"Kredi KartÄ±":s.paymentMethod==="check"?"Ã‡ek":s.paymentMethod]}),s.notes&&e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:s.notes})]})]},s.id)),t.updatedAt!==t.createdAt&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-600 rounded-full mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Fatura gÃ¼ncellendi"}),e.jsx("p",{className:"text-xs text-neutral-600",children:d(t.updatedAt)})]})]})]})]})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-4",children:"Ã–deme Kaydet"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ã–deme TutarÄ±"}),e.jsx("input",{type:"number",value:f,onChange:s=>u(s.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent",step:"0.01",min:"0",max:t==null?void 0:t.remainingAmount}),e.jsxs("p",{className:"text-xs text-neutral-600 mt-1",children:["Kalan tutar: ",r((t==null?void 0:t.remainingAmount)||0)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Ã–deme YÃ¶ntemi"}),e.jsxs("select",{value:N,onChange:s=>h(s.target.value),className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"cash",children:"Nakit"}),e.jsx("option",{value:"bank_transfer",children:"Banka Transferi"}),e.jsx("option",{value:"credit_card",children:"Kredi KartÄ±"}),e.jsx("option",{value:"check",children:"Ã‡ek"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Not (Opsiyonel)"}),e.jsx("textarea",{value:v,onChange:s=>p(s.target.value),placeholder:"Ã–deme hakkÄ±nda notlar...",className:"w-full px-4 py-2 border border-neutral-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{x(!1),u(""),h("cash"),p("")},disabled:j,className:"flex-1 px-4 py-2 border border-neutral-300 text-neutral-700 rounded-xl hover:bg-neutral-50 transition-colors disabled:opacity-50",children:"Ä°ptal"}),e.jsx("button",{onClick:$,disabled:j,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors disabled:opacity-50",children:j?"Kaydediliyor...":"Kaydet"})]})]})})]})}export{ie as default};
