import{a as ee,r as n,j as e,z as o}from"./react-vendor-DBHNAGPW.js";import{b as d}from"./index-BB04Wo6n.js";import{a as y,s as b,D as C,c as v,i as T,b as D}from"./index-C5wiI25D.js";import{P as _,u as se,C as te,F as M,o as ae,ac as le,f as re,ag as ie,a0 as ne,T as de,a as ce}from"./ui-vendor-Vc_pfhQB.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const g={async getAll(t){return(await d.get("/delivery-notes",{params:t})).data},async getById(t){return(await d.get(`/delivery-notes/${t}`)).data},async create(t){return(await d.post("/delivery-notes",t)).data},async update(t,r){return(await d.patch(`/delivery-notes/${t}`,r)).data},async delete(t){return(await d.delete(`/delivery-notes/${t}`)).data},async markAsDelivered(t){return(await d.post(`/delivery-notes/${t}/deliver`)).data},async cancel(t){return(await d.post(`/delivery-notes/${t}/cancel`)).data},async convertToInvoice(t,r){return(await d.post(`/delivery-notes/${t}/convert-to-invoice`,r)).data},async downloadPDF(t){const r=await d.get(`/delivery-notes/${t}/pdf`,{responseType:"blob"}),u=window.URL.createObjectURL(new Blob([r.data])),c=document.createElement("a");c.href=u,c.setAttribute("download",`irsaliye-${t}.pdf`),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(u)},async getStatistics(t){return(await d.get("/delivery-notes/statistics/summary",{params:t})).data}},m="px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase tracking-wider bg-neutral-50",x="px-6 py-4 text-sm text-neutral-900",oe={pending:"Beklemede",delivered:"Teslim Edildi",invoiced:"Faturalandı",cancelled:"İptal"};function je(){var P,R,I,O,W,Y;const t=ee(),[r,u]=n.useState([]),[c,z]=n.useState(!0),[S,F]=n.useState(null),[j,U]=n.useState(""),[N,H]=n.useState(""),[h,G]=n.useState(""),[p,L]=n.useState(null),[K,w]=n.useState(!1),[k,E]=n.useState(!1);n.useEffect(()=>{f()},[h]);const f=async()=>{var s,a;try{z(!0),F(null);const l=await g.getAll({status:h||void 0});u(l.data)}catch(l){F(((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"İrsaliyeler yüklenirken hata oluştu")}finally{z(!1)}},q=async s=>{var a,l;try{await g.downloadPDF(s),o.success("PDF indiriliyor...")}catch(i){o.error("PDF indirilemedi: "+(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||i.message))}},X=async()=>{var s,a;if(p)try{E(!0),await g.convertToInvoice(p.id),w(!1),L(null),await f(),o.success("İrsaliye başarıyla faturaya dönüştürüldü!")}catch(l){o.error("Faturaya dönüştürülürken hata: "+(((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||l.message))}finally{E(!1)}},J=async s=>{var a,l;if(confirm("Bu irsaliyeyi teslim edildi olarak işaretlemek istediğinizden emin misiniz?"))try{await g.markAsDelivered(s),await f(),o.success("İrsaliye teslim edildi olarak işaretlendi")}catch(i){o.error("Hata: "+(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||i.message))}},Q=async s=>{var a,l;if(confirm("Bu irsaliyeyi iptal etmek istediğinizden emin misiniz?"))try{await g.cancel(s),await f(),o.success("İrsaliye iptal edildi")}catch(i){o.error("Hata: "+(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||i.message))}},V=s=>new Date(s).toLocaleDateString("tr-TR"),$=s=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(s),B=s=>s.items.reduce((a,l)=>a+l.quantity*l.unitPrice,0),Z=s=>{const a={pending:"bg-orange-100 text-orange-800",delivered:"bg-green-100 text-green-800",invoiced:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a[s]||"bg-neutral-100 text-neutral-800"}`,children:oe[s]||s})},A=r.filter(s=>{const a=j===""||s.deliveryNumber.toLowerCase().includes(j.toLowerCase())||s.customer.name.toLowerCase().includes(j.toLowerCase()),l=N===""||s.deliveryType===N,i=h===""||s.status===h;return a&&l&&i});return c?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-neutral-600"})}):e.jsxs("div",{className:"space-y-6",style:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[S&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsx("p",{className:"text-red-800 text-sm",children:S})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",style:{boxSizing:"border-box"},children:[e.jsxs("div",{className:y("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:b("primary"),children:e.jsx(_,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Toplam"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:r.length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"İrsaliye"})]}),e.jsxs("div",{className:y("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:b("warning"),children:e.jsx(se,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Beklemede"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:r.filter(s=>s.status==="pending").length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"İrsaliye"})]}),e.jsxs("div",{className:y("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:b("success"),children:e.jsx(te,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Teslim Edildi"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:r.filter(s=>s.status==="delivered").length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"İrsaliye"})]}),e.jsxs("div",{className:y("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:b("info"),children:e.jsx(M,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Faturalandı"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:r.filter(s=>s.status==="invoiced").length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"İrsaliye"})]})]}),e.jsx("div",{className:y("sm","sm","default","lg"),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${(R=(P=C)==null?void 0:P.colors)==null?void 0:R.text.muted}`,size:18}),e.jsx("input",{type:"text",placeholder:"İrsaliye ara...",value:j,onChange:s=>U(s.target.value),className:v(T("md","default",void 0,"md"),"pl-10")})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",style:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("select",{value:N,onChange:s=>H(s.target.value),className:v(T("md","default",void 0,"md"),"flex-1 min-w-[150px] max-w-[200px]"),style:{boxSizing:"border-box"},children:[e.jsx("option",{value:"",children:"Tüm Kategoriler"}),e.jsx("option",{value:"sevk",children:"Sevk"}),e.jsx("option",{value:"tahsilat",children:"Tahsilat"})]}),e.jsxs("select",{value:h,onChange:s=>G(s.target.value),className:v(T("md","default",void 0,"md"),"flex-1 min-w-[130px]"),children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"pending",children:"Beklemede"}),e.jsx("option",{value:"delivered",children:"Teslim Edildi"}),e.jsx("option",{value:"invoiced",children:"Faturalandı"}),e.jsx("option",{value:"cancelled",children:"İptal"})]}),e.jsxs("button",{onClick:()=>t("/delivery-notes/new"),className:v(D("md","primary","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(le,{size:18}),e.jsx("span",{children:"Yeni İrsaliye"})]})]})]})}),e.jsx("div",{className:y("sm","sm","default","lg"),style:{overflow:"hidden",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:c?e.jsx("div",{className:"p-12 text-center text-neutral-600",children:"Yükleniyor..."}):A.length===0?e.jsxs("div",{className:"p-12 text-center text-neutral-600",children:[e.jsx(_,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{className:"text-lg font-medium",children:"İrsaliye bulunamadı"}),e.jsx("p",{className:"text-sm mt-2",children:j||N||h?"Arama kriterlerinize uygun irsaliye bulunamadı":"Yeni irsaliye ekleyerek başlayın"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"overflow-x-auto",style:{maxWidth:"100%",width:"100%"},children:e.jsxs("table",{className:"w-full",style:{tableLayout:"fixed",width:"100%",maxWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:m,children:"İrsaliye No"}),e.jsx("th",{className:`${m} hidden lg:table-cell`,children:"Tarih"}),e.jsx("th",{className:m,children:"Müşteri"}),e.jsx("th",{className:`${m} hidden md:table-cell`,children:"Tip"}),e.jsx("th",{className:m,children:"Tutar"}),e.jsx("th",{className:m,children:"Durum"}),e.jsx("th",{className:m,children:"İşlemler"})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors",children:[e.jsx("td",{className:x,children:e.jsx("div",{className:"font-medium text-neutral-900",children:s.deliveryNumber})}),e.jsx("td",{className:`${x} hidden lg:table-cell`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-sm text-neutral-900",children:V(s.deliveryDate)})]})}),e.jsx("td",{className:x,children:e.jsx("div",{className:"font-medium text-neutral-900",children:s.customer.name})}),e.jsx("td",{className:`${x} hidden md:table-cell`,children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-neutral-100 text-neutral-800",children:s.deliveryType==="sevk"?"Sevk":"Tahsilat"})}),e.jsx("td",{className:x,children:e.jsx("span",{className:"font-medium text-neutral-900",children:$(B(s))})}),e.jsx("td",{className:x,children:Z(s.status)}),e.jsx("td",{className:x,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(`/delivery-notes/${s.id}`),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"Görüntüle",children:e.jsx(ie,{className:"text-neutral-600",size:16})}),e.jsx("button",{onClick:()=>q(s.id),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"PDF İndir",children:e.jsx(ne,{className:"text-neutral-600",size:16})}),s.status==="pending"&&e.jsx("button",{onClick:()=>J(s.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors",title:"Teslim Edildi",children:e.jsx(de,{className:"text-green-600",size:16})}),(s.status==="pending"||s.status==="delivered")&&!s.invoice&&e.jsx("button",{onClick:()=>{L(s),w(!0)},className:"p-2 hover:bg-blue-100 rounded-lg transition-colors",title:"Faturaya Dönüştür",children:e.jsx(M,{className:"text-blue-600",size:16})}),s.status==="pending"&&e.jsx("button",{onClick:()=>Q(s.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors",title:"İptal",children:e.jsx(ce,{className:"text-red-600",size:16})})]})})]},s.id))})]})})})}),K&&p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:`${(O=(I=C)==null?void 0:I.typography)==null?void 0:O.h3} ${(Y=(W=C)==null?void 0:W.colors)==null?void 0:Y.text.primary} mb-4`,children:"Faturaya Dönüştür"}),e.jsxs("p",{className:"text-neutral-600 mb-4",children:[e.jsx("strong",{children:p.deliveryNumber})," numaralı irsaliyeyi faturaya dönüştürmek istediğinizden emin misiniz?"]}),e.jsxs("div",{className:"bg-neutral-50 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-neutral-600",children:["Müşteri: ",p.customer.name]}),e.jsxs("p",{className:"text-sm text-neutral-600 mt-1",children:["Tutar: ",$(B(p))]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>w(!1),className:D("md","outline","md"),disabled:k,children:"İptal"}),e.jsx("button",{onClick:X,className:v(D("md","primary","md"),"flex-1"),disabled:k,children:k?"Dönüştürülüyor...":"Faturaya Dönüştür"})]})]})})]})}export{je as default};
