import{r as h,j as e,t as f}from"./react-vendor-DBHNAGPW.js";import{D as p,c as ce,a as b,i as H}from"./index-C5wiI25D.js";import{a8 as de,a2 as E,F as z,C as g,A as M,a as me,o as oe,bf as X,a0 as ue}from"./ui-vendor-Vc_pfhQB.js";import"./chart-vendor-R5Y1AjBI.js";function ve(){var F,R,$,L,I,W,O,U,G,K,P,V,Y,_;const[N,A]=h.useState("overview"),[d,k]=h.useState([]),[u,D]=h.useState([]),[q,y]=h.useState(!1),[J,Q]=h.useState("all"),[xe,he]=h.useState({start:new Date(new Date().setDate(1)).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[w,Z]=h.useState(""),[j,ee]=h.useState("all"),C=h.useRef(null),te=[{id:"1",name:"İş Bankası - Ticari",accountNumber:"1234567890",balance:125e3},{id:"2",name:"Garanti BBVA - Vadesiz",accountNumber:"9876543210",balance:85e3},{id:"3",name:"Yapı Kredi - USD",accountNumber:"5555666677",balance:15e3}],ae=async()=>{var t,a;if(selectedAccount){y(!0);try{const n=localStorage.getItem("token"),l=await fetch(`http://localhost:4000/api/accounting/bank-account/${selectedAccount}/transactions`,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!l.ok)throw new Error("Banka işlemleri yüklenemedi");const v=((a=(t=(await l.json()).data)==null?void 0:t.transactions)==null?void 0:a.map(i=>{var c;return{id:((c=i.id)==null?void 0:c.toString())||"",date:i.date||i.createdAt?new Date(i.date||i.createdAt).toISOString().split("T")[0]:"",description:i.description||i.notes||"",amount:parseFloat(i.amount||0),type:i.type==="credit"||i.transactionType==="credit"?"credit":"debit",balance:parseFloat(i.balance||0),reference:i.reference||i.referenceNumber,matched:i.matched||!1,matchedWith:i.matchedWith||i.matchedTransactionId,category:i.category||"Bilinmeyen"}}))||[];k(v),setFilteredBankTransactions(v)}catch(n){console.error("Banka işlemleri yüklenirken hata:",n),f.error("Banka işlemleri yüklenemedi"),k([]),setFilteredBankTransactions([])}finally{y(!1)}}},se=async t=>{var n;const a=(n=t.target.files)==null?void 0:n[0];if(a){y(!0);try{await new Promise(s=>setTimeout(s,1500)),await ae(),f.success(`${a.name} başarıyla içe aktarıldı`)}catch(s){console.error("Failed to upload file:",s),f.error("Dosya yüklenemedi")}finally{y(!1),C.current&&(C.current.value="")}}},le=async()=>{y(!0);try{await new Promise(s=>setTimeout(s,1e3));let t=0;const a=d.map(s=>{if(s.matched)return s;const l=u.find(r=>{if(r.matched)return!1;const v=new Date(s.date),i=new Date(r.date),c=Math.abs((v.getTime()-i.getTime())/(1e3*60*60*24)),x=Math.abs(s.amount-r.amount)<.01,ie=c<=3;return x&&ie});return l?(t++,{...s,matched:!0,matchedWith:l.id}):s}),n=u.map(s=>a.some(r=>r.matchedWith===s.id)?{...s,matched:!0}:s);k(a),D(n),f.success(`${t} işlem otomatik eşleştirildi`)}catch(t){console.error("Auto match failed:",t),f.error("Otomatik eşleştirme başarısız")}finally{y(!1)}},ne=(t,a)=>{const n=d.map(l=>l.id===t?{...l,matched:!0,matchedWith:a}:l),s=u.map(l=>l.id===a?{...l,matched:!0}:l);k(n),D(s),f.success("İşlemler manuel olarak eşleştirildi")},re=t=>{const a=d.find(l=>l.id===t);if(!a||!a.matchedWith)return;const n=d.map(l=>l.id===t?{...l,matched:!1,matchedWith:void 0}:l),s=u.map(l=>l.id===a.matchedWith?{...l,matched:!1}:l);k(n),D(s),f.success("Eşleştirme kaldırıldı")},m=(()=>{const t=d.length,a=u.length,n=d.filter(c=>c.matched).length,s=d.filter(c=>!c.matched).length,l=u.filter(c=>!c.matched).length,r=d.reduce((c,x)=>c+(x.type==="credit"?x.amount:-x.amount),0),v=u.reduce((c,x)=>c+(x.type==="income"?x.amount:-x.amount),0),i=r-v;return{totalBankTransactions:t,totalSystemTransactions:a,matchedCount:n,unmatchedBankCount:s,unmatchedSystemCount:l,differenceAmount:i}})(),o=t=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.abs(t)),B=t=>new Date(t).toLocaleDateString("tr-TR",{day:"2-digit",month:"short",year:"numeric"}),S=d.filter(t=>{var s;const a=t.description.toLowerCase().includes(w.toLowerCase())||((s=t.reference)==null?void 0:s.toLowerCase().includes(w.toLowerCase())),n=j==="all"||j==="matched"&&t.matched||j==="unmatched"&&!t.matched;return a&&n}),T=u.filter(t=>{var s;const a=t.description.toLowerCase().includes(w.toLowerCase())||((s=t.reference)==null?void 0:s.toLowerCase().includes(w.toLowerCase())),n=j==="all"||j==="matched"&&t.matched||j==="unmatched"&&!t.matched;return a&&n});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`${(R=(F=p)==null?void 0:F.typography)==null?void 0:R.h2} ${(L=($=p)==null?void 0:$.colors)==null?void 0:L.text.primary}`,children:"Banka Mutabakat"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:"Banka ekstresi ile sistem kayıtlarını karşılaştır"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",ref:C,onChange:se,accept:".csv,.xlsx,.xls",className:"hidden"}),e.jsxs("button",{onClick:()=>{var t;return(t=C.current)==null?void 0:t.click()},className:"flex items-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors",children:[e.jsx(de,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Ekstre Yükle"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(E,{size:20}),e.jsx("span",{className:(W=(I=p)==null?void 0:I.typography)==null?void 0:W.stat.md,children:m.totalBankTransactions})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Banka İşlemi"})]}),e.jsxs("div",{className:"bg-neutral-800 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(z,{size:20}),e.jsx("span",{className:(U=(O=p)==null?void 0:O.typography)==null?void 0:U.stat.md,children:m.totalSystemTransactions})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Sistem Kaydı"})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(g,{size:20}),e.jsx("span",{className:(K=(G=p)==null?void 0:G.typography)==null?void 0:K.stat.md,children:m.matchedCount})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Eşleşti"})]}),e.jsxs("div",{className:"bg-neutral-700 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(M,{size:20}),e.jsx("span",{className:(V=(P=p)==null?void 0:P.typography)==null?void 0:V.stat.md,children:m.unmatchedBankCount})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Banka (Eşleşmedi)"})]}),e.jsxs("div",{className:"bg-neutral-600 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(M,{size:20}),e.jsx("span",{className:(_=(Y=p)==null?void 0:Y.typography)==null?void 0:_.stat.md,children:m.unmatchedSystemCount})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Sistem (Eşleşmedi)"})]}),e.jsxs("div",{className:`rounded-2xl p-4 text-white ${Math.abs(m.differenceAmount)<.01?"bg-neutral-900":"bg-neutral-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Math.abs(m.differenceAmount)<.01?e.jsx(g,{size:20}):e.jsx(me,{size:20}),e.jsx("span",{className:"text-lg font-bold",children:o(m.differenceAmount)})]}),e.jsx("div",{className:"text-sm opacity-90",children:"Fark"})]})]}),e.jsxs("div",{className:ce(b("md","xs","default","lg"),"flex gap-2"),children:[e.jsx("button",{onClick:()=>A("overview"),className:`flex-1 px-4 py-2 rounded-xl font-medium transition-colors ${N==="overview"?"bg-neutral-900 text-white":"text-neutral-700 hover:bg-neutral-100"}`,children:"Genel Bakış"}),e.jsx("button",{onClick:()=>A("match"),className:`flex-1 px-4 py-2 rounded-xl font-medium transition-colors ${N==="match"?"bg-neutral-900 text-white":"text-neutral-700 hover:bg-neutral-100"}`,children:"Eşleştirme"}),e.jsx("button",{onClick:()=>A("report"),className:`flex-1 px-4 py-2 rounded-xl font-medium transition-colors ${N==="report"?"bg-neutral-900 text-white":"text-neutral-700 hover:bg-neutral-100"}`,children:"Rapor"})]}),N==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:b("md","sm","default","lg"),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-3 text-neutral-400",size:18}),e.jsx("input",{type:"text",placeholder:"İşlem ara...",value:w,onChange:t=>Z(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-neutral-900"})]}),e.jsxs("select",{value:J,onChange:t=>Q(t.target.value),className:H("md","default",void 0,"md"),children:[e.jsx("option",{value:"all",children:"Tüm Hesaplar"}),te.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:j,onChange:t=>ee(t.target.value),className:H("md","default",void 0,"md"),children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"matched",children:"Eşleşenler"}),e.jsx("option",{value:"unmatched",children:"Eşleşmeyenler"})]}),e.jsxs("button",{onClick:le,disabled:q,className:"flex items-center justify-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors disabled:opacity-50",children:[e.jsx(X,{size:18}),e.jsx("span",{children:"Otomatik Eşleştir"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:b("md","none","default","lg"),children:[e.jsx("div",{className:"p-4 border-b border-neutral-200",children:e.jsxs("h3",{className:"font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(E,{size:20}),"Banka İşlemleri (",S.length,")"]})}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:S.length===0?e.jsxs("div",{className:"p-8 text-center text-neutral-600",children:[e.jsx(E,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{children:"Banka işlemi bulunamadı"}),e.jsx("p",{className:"text-sm mt-2",children:"Ekstre dosyası yükleyin"})]}):e.jsx("div",{className:"divide-y divide-neutral-100",children:S.map(t=>e.jsxs("div",{className:"p-4 hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-neutral-900",children:t.description}),t.matched&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-neutral-100 text-neutral-800 rounded-full text-xs",children:[e.jsx(g,{size:12}),"Eşleşti"]})]}),e.jsx("div",{className:"text-xs text-neutral-600",children:B(t.date)}),t.reference&&e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Ref: ",t.reference]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"font-bold text-neutral-900",children:[t.type==="credit"?"+":"-",o(t.amount)]}),t.matched&&e.jsx("button",{onClick:()=>re(t.id),className:"mt-1 text-xs text-neutral-900 hover:underline",children:"Eşleştirmeyi Kaldır"})]})]}),t.category&&e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:e.jsx("span",{className:"px-2 py-1 bg-neutral-100 rounded-full",children:t.category})})]},t.id))})})]}),e.jsxs("div",{className:b("md","none","default","lg"),children:[e.jsx("div",{className:"p-4 border-b border-neutral-200",children:e.jsxs("h3",{className:"font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(z,{size:20}),"Sistem Kayıtları (",T.length,")"]})}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:T.length===0?e.jsxs("div",{className:"p-8 text-center text-neutral-600",children:[e.jsx(z,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{children:"Sistem kaydı bulunamadı"})]}):e.jsx("div",{className:"divide-y divide-neutral-100",children:T.map(t=>e.jsxs("div",{className:"p-4 hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-neutral-900",children:t.description}),t.matched&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-neutral-100 text-neutral-800 rounded-full text-xs",children:[e.jsx(g,{size:12}),"Eşleşti"]})]}),e.jsx("div",{className:"text-xs text-neutral-600",children:B(t.date)}),t.reference&&e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Ref: ",t.reference]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"font-bold text-neutral-900",children:[t.type==="income"?"+":"-",o(t.amount)]})})]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:e.jsx("span",{className:"px-2 py-1 bg-neutral-100 rounded-full",children:t.category})})]},t.id))})})]})]})]}),N==="match"&&e.jsxs("div",{className:b("md","lg","default","lg"),children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Manuel Eşleştirme"}),e.jsx("p",{className:"text-sm text-neutral-600 mb-6",children:"Eşleşmeyen işlemleri manuel olarak birbirine bağlayın"}),e.jsxs("div",{className:"space-y-4",children:[S.filter(t=>!t.matched).slice(0,3).map(t=>{var a,n,s,l;return e.jsxs("div",{className:"border border-neutral-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-neutral-900",children:t.description}),e.jsxs("div",{className:`${(n=(a=p)==null?void 0:a.typography)==null?void 0:n.body.sm} ${(l=(s=p)==null?void 0:s.colors)==null?void 0:l.text.secondary}`,children:[B(t.date)," • ",o(t.amount)]})]}),e.jsx(X,{className:"text-neutral-400",size:20})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-700 mb-2",children:"Olası Eşleşmeler:"}),T.filter(r=>!r.matched&&Math.abs(r.amount-t.amount)<.01).map(r=>e.jsxs("button",{onClick:()=>ne(t.id,r.id),className:"w-full flex items-center justify-between p-3 border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900",children:r.description}),e.jsxs("div",{className:"text-xs text-neutral-600",children:[B(r.date)," • ",r.category]})]}),e.jsx("div",{className:"text-sm font-bold text-neutral-900",children:o(r.amount)})]},r.id)),T.filter(r=>!r.matched&&Math.abs(r.amount-t.amount)<.01).length===0&&e.jsx("div",{className:"text-sm text-neutral-500 italic p-3 bg-neutral-50 rounded-lg",children:"Uygun eşleşme bulunamadı"})]})]},t.id)}),S.filter(t=>!t.matched).length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"mx-auto mb-4 text-neutral-900",size:48}),e.jsx("p",{className:"text-lg font-medium text-neutral-900",children:"Tüm işlemler eşleştirildi!"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-2",children:"Eşleşmeyen banka işlemi kalmadı"})]})]})]}),N==="report"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:b("md","lg","default","lg"),children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-6",children:"Mutabakat Raporu"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-neutral-900",children:"Banka Özeti"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam Giriş:"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:o(d.filter(t=>t.type==="credit").reduce((t,a)=>t+a.amount,0))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam Çıkış:"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:o(d.filter(t=>t.type==="debit").reduce((t,a)=>t+a.amount,0))})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-neutral-900 font-medium",children:"Net:"}),e.jsx("span",{className:"font-bold text-neutral-900",children:o(d.reduce((t,a)=>t+(a.type==="credit"?a.amount:-a.amount),0))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-neutral-900",children:"Sistem Özeti"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam Gelir:"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:o(u.filter(t=>t.type==="income").reduce((t,a)=>t+a.amount,0))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam Gider:"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:o(u.filter(t=>t.type==="expense").reduce((t,a)=>t+a.amount,0))})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-neutral-900 font-medium",children:"Net:"}),e.jsx("span",{className:"font-bold text-neutral-900",children:o(u.reduce((t,a)=>t+(a.type==="income"?a.amount:-a.amount),0))})]})]})]})]}),e.jsx("div",{className:"p-6 rounded-xl bg-neutral-50 border border-neutral-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-neutral-900",children:Math.abs(m.differenceAmount)<.01?"Mutabakat Sağlandı ✓":"Mutabakat Farkı Var!"}),e.jsx("p",{className:"text-sm mt-1 text-neutral-700",children:Math.abs(m.differenceAmount)<.01?"Banka ve sistem kayıtları tam olarak eşleşiyor":`Fark tutarı: ${o(m.differenceAmount)}`})]}),Math.abs(m.differenceAmount)<.01?e.jsx(g,{className:"text-neutral-900",size:48}):e.jsx(M,{className:"text-neutral-700",size:48})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 border border-neutral-300 rounded-xl hover:bg-neutral-50 transition-colors",children:[e.jsx(ue,{size:18}),e.jsx("span",{children:"Excel İndir"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors",children:[e.jsx(z,{size:18}),e.jsx("span",{children:"PDF Rapor"})]})]})]})]})})]})}export{ve as default};
