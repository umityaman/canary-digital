import{o as $,a as q,r as h,z as l,j as e,v as B}from"./react-vendor-DBHNAGPW.js";import{o as u}from"./index-BB04Wo6n.js";import{D as G}from"./DetailSkeleton-ZBWuwSwT.js";import{F as p,am as k,an as j,C as g,a as b,h as I,a0 as M,a1 as L,Q as R,a5 as T,ap as K,u as f,f as Q,a2 as U}from"./ui-vendor-Vc_pfhQB.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";function W(){const{id:x}=$(),d=q(),[t,z]=h.useState(null),[D,N]=h.useState(!0);h.useEffect(()=>{x&&v()},[x]);const v=async()=>{var s,r;try{N(!0),console.log("üîç Loading quote:",x);const a=await u.getById(Number(x));console.log("‚úÖ Quote loaded:",a.data),z(a.data.data||a.data)}catch(a){console.error("‚ùå Failed to load quote:",a),l.error("Teklif y√ºklenemedi: "+(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message)),setTimeout(()=>d("/accounting?tab=offer"),2e3)}finally{N(!1)}},C=async()=>{var s,r;if(t&&confirm(`${t.quoteNumber} numaralƒ± teklifi silmek istediƒüinizden emin misiniz?`))try{await u.delete(t.id),l.success("Teklif ba≈üarƒ±yla silindi"),d("/accounting?tab=offer")}catch(a){console.error("Failed to delete quote:",a),l.error("Teklif silinemedi: "+(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message))}},c=async s=>{var r,a;if(t)try{await u.updateStatus(t.id,s),l.success("Teklif durumu g√ºncellendi"),v()}catch(i){console.error("Failed to update status:",i),l.error("Durum g√ºncellenemedi: "+(((a=(r=i.response)==null?void 0:r.data)==null?void 0:a.message)||i.message))}},y=async()=>{var s,r;if(t&&confirm("Bu teklifi faturaya d√∂n√º≈üt√ºrmek istediƒüinizden emin misiniz?"))try{const a=new Date().toISOString().split("T")[0],i=new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0],P=await u.convertToInvoice(t.id,{orderId:t.id,startDate:a,endDate:i,notes:"Tekliften otomatik olu≈üturuldu"});l.success("Teklif ba≈üarƒ±yla faturaya d√∂n√º≈üt√ºr√ºld√º"),d(`/accounting/invoice/${P.data.invoice.id}`)}catch(a){console.error("Failed to convert quote:",a),l.error("D√∂n√º≈üt√ºrme ba≈üarƒ±sƒ±z: "+(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message))}},S=()=>{window.print()},F=async()=>{try{l.success("PDF indirme √∂zelliƒüi yakƒ±nda eklenecek")}catch{l.error("PDF indirilemedi")}},A=async()=>{try{l.success("E-posta g√∂nderme √∂zelliƒüi yakƒ±nda eklenecek")}catch{l.error("E-posta g√∂nderilemedi")}},E=async()=>{try{navigator.share?await navigator.share({title:`Teklif ${t==null?void 0:t.quoteNumber}`,text:`${t==null?void 0:t.customer.name} - ${n((t==null?void 0:t.grandTotal)||0)}`,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),l.success("Link kopyalandƒ±"))}catch(s){console.error("Share failed:",s)}},n=s=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),o=s=>new Date(s).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}),w=s=>{const r={draft:{label:"Taslak",color:"bg-neutral-100 text-gray-800",icon:p},sent:{label:"G√∂nderildi",color:"bg-blue-100 text-blue-800",icon:j},accepted:{label:"Kabul Edildi",color:"bg-green-100 text-green-800",icon:g},rejected:{label:"Reddedildi",color:"bg-red-100 text-red-800",icon:b},expired:{label:"S√ºresi Doldu",color:"bg-orange-100 text-orange-800",icon:f}},a=r[s]||r.draft,i=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${a.color}`,children:[e.jsx(i,{size:14}),a.label]})},m=t&&new Date(t.validUntil)<new Date;return D?e.jsx(G,{}):t?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 print:hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>d("/accounting?tab=offer"),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(k,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:t.quoteNumber}),e.jsx("p",{className:"text-sm text-neutral-600",children:t.customer.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="draft"&&e.jsxs("button",{onClick:()=>c("sent"),className:"px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(j,{size:18}),"G√∂nder"]}),t.status==="sent"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("accepted"),className:"px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(g,{size:18}),"Kabul Et"]}),e.jsxs("button",{onClick:()=>c("rejected"),className:"px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(b,{size:18}),"Reddet"]})]}),(t.status==="accepted"||t.status==="sent")&&e.jsx("button",{onClick:y,className:"px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors",children:"Faturala"}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"Payla≈ü",children:e.jsx(I,{size:20})}),e.jsx("button",{onClick:F,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"PDF ƒ∞ndir",children:e.jsx(M,{size:20})}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"Yazdƒ±r",children:e.jsx(L,{size:20})}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",title:"E-posta G√∂nder",children:e.jsx(R,{size:20})}),e.jsxs("button",{onClick:()=>d(`/accounting/quote/${t.id}/edit`),className:"px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors flex items-center gap-2",children:[e.jsx(T,{size:18}),"D√ºzenle"]}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-red-100 text-red-600 rounded-lg transition-colors",title:"Sil",children:e.jsx(K,{size:20})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Teklif Bilgileri"}),e.jsxs("div",{className:"flex items-center gap-2",children:[w(t.status),m&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:[e.jsx(f,{size:14}),"S√ºresi Doldu"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-600 mb-1",children:[e.jsx(Q,{size:16}),"Teklif Tarihi"]}),e.jsx("p",{className:"font-medium text-neutral-900",children:o(t.quoteDate)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-neutral-600 mb-1",children:[e.jsx(f,{size:16}),"Ge√ßerlilik Tarihi"]}),e.jsx("p",{className:`font-medium ${m?"text-red-600":"text-neutral-900"}`,children:o(t.validUntil)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:20}),"M√º≈üteri Bilgileri"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Ad/√únvan"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.name})]}),t.customer.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"E-posta"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.email})]}),t.customer.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Telefon"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.phone})]}),t.customer.taxNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Vergi No"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.taxNumber})]}),t.customer.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Adres"}),e.jsx("p",{className:"font-medium text-neutral-900",children:t.customer.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200",children:e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Kalemler"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-700 uppercase",children:"A√ßƒ±klama"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Miktar"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"G√ºn"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Birim Fiyat"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-700 uppercase",children:"Toplam"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:t.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.description}),s.equipment&&e.jsxs("p",{className:"text-sm text-neutral-600",children:[s.equipment.name,s.equipment.serialNumber&&` (${s.equipment.serialNumber})`]})]})}),e.jsx("td",{className:"px-6 py-4 text-right text-neutral-900",children:s.quantity}),e.jsx("td",{className:"px-6 py-4 text-right text-neutral-900",children:s.days}),e.jsx("td",{className:"px-6 py-4 text-right text-neutral-900",children:n(s.unitPrice)}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-neutral-900",children:n(s.total)})]},s.id))})]})}),e.jsx("div",{className:"p-6 bg-neutral-50 border-t border-neutral-200",children:e.jsxs("div",{className:"max-w-sm ml-auto space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"Ara Toplam"}),e.jsx("span",{className:"font-medium",children:n(t.subtotal)})]}),t.discountAmount&&t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"ƒ∞ndirim"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",n(t.discountAmount)]})]}),e.jsxs("div",{className:"flex justify-between text-neutral-700",children:[e.jsx("span",{children:"KDV"}),e.jsx("span",{className:"font-medium",children:n(t.taxAmount)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-neutral-900 pt-2 border-t border-neutral-300",children:[e.jsx("span",{children:"Genel Toplam"}),e.jsx("span",{children:n(t.grandTotal)})]})]})})]}),t.notes&&e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 mb-3",children:"Notlar"}),e.jsx("p",{className:"text-neutral-700 whitespace-pre-wrap",children:t.notes})]}),t.termsAndConditions&&e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 mb-3",children:"≈ûartlar ve Ko≈üullar"}),e.jsx("p",{className:"text-neutral-700 whitespace-pre-wrap text-sm",children:t.termsAndConditions})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Hƒ±zlƒ± ƒ∞≈ülemler"}),e.jsxs("div",{className:"space-y-2",children:[t.status==="draft"&&e.jsxs("button",{onClick:()=>c("sent"),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(j,{size:18}),"M√º≈üteriye G√∂nder"]}),t.status==="sent"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("accepted"),className:"w-full px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(g,{size:18}),"Kabul Edildi"]}),e.jsxs("button",{onClick:()=>c("rejected"),className:"w-full px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(b,{size:18}),"Reddedildi"]})]}),(t.status==="accepted"||t.status==="sent")&&!m&&e.jsxs("button",{onClick:y,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{size:18}),"Faturaya D√∂n√º≈üt√ºr"]}),e.jsxs("button",{onClick:()=>d(`/accounting/quote/${t.id}/edit`),className:"w-full px-4 py-2 bg-neutral-100 text-neutral-900 rounded-xl hover:bg-neutral-200 transition-colors flex items-center justify-center gap-2",children:[e.jsx(T,{size:18}),"D√ºzenle"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Durum Ge√ßmi≈üi"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Teklif olu≈üturuldu"}),e.jsx("p",{className:"text-xs text-neutral-600",children:o(t.createdAt)}),t.createdBy&&e.jsx("p",{className:"text-xs text-neutral-500",children:t.createdBy.name})]})]}),t.updatedAt!==t.createdAt&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-600 rounded-full mt-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Teklif g√ºncellendi"}),e.jsx("p",{className:"text-xs text-neutral-600",children:o(t.updatedAt)})]})]}),t.status==="sent"&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-2"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"M√º≈üteriye g√∂nderildi"})})]}),t.status==="accepted"&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full mt-2"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Teklif kabul edildi"})})]}),t.status==="rejected"&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full mt-2"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-neutral-900",children:"Teklif reddedildi"})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"√ñzet"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Toplam Tutar"}),e.jsx("span",{className:"font-semibold text-neutral-900",children:n(t.grandTotal)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Ge√ßerlilik"}),e.jsx("span",{className:`font-medium ${m?"text-red-600":"text-neutral-900"}`,children:o(t.validUntil)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-600",children:"Durum"}),e.jsx("span",{children:w(t.status)})]})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{size:48,className:"text-neutral-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Teklif bulunamadƒ±"}),e.jsx("p",{className:"text-neutral-600 mb-4",children:"Bu teklif silinmi≈ü veya mevcut deƒüil."}),e.jsxs(B,{to:"/accounting?tab=offer",className:"inline-flex items-center gap-2 px-4 py-2 bg-neutral-900 text-white rounded-xl hover:bg-neutral-800 transition-colors",children:[e.jsx(k,{size:18}),"Teklif Listesine D√∂n"]})]})})}export{W as default};
