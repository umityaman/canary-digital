import{r as n,j as e,t as h}from"./react-vendor-DBHNAGPW.js";import{d as re}from"./index-BB04Wo6n.js";import{c as x,D as s,i as p,b as y,a as k,s as me,d as ye}from"./index-C5wiI25D.js";import{X as be,a8 as fe,w as Ne,D as ve,F as je,o as ke,a0 as Se,ac as we,f as Ee,a5 as De,ap as ze}from"./ui-vendor-Vc_pfhQB.js";import"./chart-vendor-R5Y1AjBI.js";import"./state-vendor-JOdu_MDH.js";const Te=["Personel Maaşları","Kira","Elektrik/Su/Doğalgaz","İnternet/Telefon","Malzeme Alımı","Ekipman Bakım/Onarım","Pazarlama/Reklam","Sigorta","Vergi/Harçlar","Yakıt","Seyahat/Konaklama","Yemek","Diğer"],Me=["Nakit","Banka Transferi","Kredi Kartı","Çek","Senet"],Ce=[{value:"paid",label:"Ödendi"},{value:"pending",label:"Beklemede"},{value:"cancelled",label:"İptal"}];function $e({open:g,onClose:S,onSaved:ne,initial:o}){var E,I,$,de,P,ce,j,F,D,G,W,q,H,J,X,A,V,z,Q,Z,ee,ae,b,te,se,B,K,L,O,R,U,a,u,m,r,le,i,d,xe,ue,he,pe;const[l,c]=n.useState({description:"",amount:0,category:"Malzeme Alımı",date:new Date().toISOString().split("T")[0],status:"paid",paymentMethod:"Nakit",notes:"",receiptUrl:""}),[Y,w]=n.useState(!1),[M,_]=n.useState(!1);n.useEffect(()=>{c(o?{...o,date:o.date.split("T")[0]}:{description:"",amount:0,category:"Malzeme Alımı",date:new Date().toISOString().split("T")[0],status:"paid",paymentMethod:"Nakit",notes:"",receiptUrl:""})},[o,g]);const C=async t=>{var T;const f=(T=t.target.files)==null?void 0:T[0];if(!f)return;if(f.size>5*1024*1024){h.error("Dosya boyutu en fazla 5MB olabilir");return}if(!["image/jpeg","image/png","image/jpg","application/pdf"].includes(f.type)){h.error("Sadece JPG, PNG veya PDF dosyaları yüklenebilir");return}_(!0);try{const ge=URL.createObjectURL(f);c({...l,receiptUrl:ge}),h.success("Makbuz yüklendi")}catch{h.error("Makbuz yüklenirken hata oluştu")}finally{_(!1)}},ie=async t=>{var f,oe;if(t.preventDefault(),!l.description||l.amount<=0){h.error("Lütfen zorunlu alanları doldurun");return}w(!0);try{o!=null&&o.id?(await re.updateExpense(o.id,l),h.success("Gider güncellendi")):(await re.createExpense(l),h.success("Gider kaydedildi")),ne(),S()}catch(T){console.error("Expense save error:",T),h.error(((oe=(f=T.response)==null?void 0:f.data)==null?void 0:oe.message)||T.message||"Bir hata oluştu")}finally{w(!1)}};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:x(k("lg","none","default","xl"),"w-full max-w-2xl max-h-[90vh] overflow-y-auto"),children:[e.jsxs("div",{className:x("sticky top-0 bg-white border-b border-neutral-200",(I=(E=s)==null?void 0:E.spacing)==null?void 0:I.padding.md,"flex items-center justify-between"),children:[e.jsx("h2",{className:`${(de=($=s)==null?void 0:$.typography)==null?void 0:de.h2} ${(ce=(P=s)==null?void 0:P.colors)==null?void 0:ce.text.primary}`,children:o?"Gider Düzenle":"Yeni Gider"}),e.jsx("button",{onClick:S,className:`${(F=(j=s)==null?void 0:j.colors)==null?void 0:F.text.muted} hover:text-neutral-600 transition-colors`,children:e.jsx(be,{size:24})})]}),e.jsxs("form",{onSubmit:ie,className:x((G=(D=s)==null?void 0:D.spacing)==null?void 0:G.padding.md,"space-y-4"),children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(q=(W=s)==null?void 0:W.typography)==null?void 0:q.body.sm} font-medium ${(J=(H=s)==null?void 0:H.colors)==null?void 0:J.text.secondary} mb-2`,children:"Açıklama *"}),e.jsx("textarea",{value:l.description,onChange:t=>c({...l,description:t.target.value}),className:p("md","default",void 0,"md"),rows:3,placeholder:"Gider açıklaması...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(A=(X=s)==null?void 0:X.typography)==null?void 0:A.body.sm} font-medium ${(z=(V=s)==null?void 0:V.colors)==null?void 0:z.text.secondary} mb-2`,children:"Tutar (₺) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.amount,onChange:t=>c({...l,amount:parseFloat(t.target.value)}),className:p("md","default",void 0,"md"),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(Z=(Q=s)==null?void 0:Q.typography)==null?void 0:Z.body.sm} font-medium ${(ae=(ee=s)==null?void 0:ee.colors)==null?void 0:ae.text.secondary} mb-2`,children:"Kategori *"}),e.jsx("select",{value:l.category,onChange:t=>c({...l,category:t.target.value}),className:p("md","default",void 0,"md"),children:Te.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${(te=(b=s)==null?void 0:b.typography)==null?void 0:te.body.sm} font-medium ${(B=(se=s)==null?void 0:se.colors)==null?void 0:B.text.secondary} mb-2`,children:"Tarih *"}),e.jsx("input",{type:"date",value:l.date,onChange:t=>c({...l,date:t.target.value}),className:p("md","default",void 0,"md"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(L=(K=s)==null?void 0:K.typography)==null?void 0:L.body.sm} font-medium ${(R=(O=s)==null?void 0:O.colors)==null?void 0:R.text.secondary} mb-2`,children:"Ödeme Yöntemi *"}),e.jsx("select",{value:l.paymentMethod,onChange:t=>c({...l,paymentMethod:t.target.value}),className:p("md","default",void 0,"md"),children:Me.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(a=(U=s)==null?void 0:U.typography)==null?void 0:a.body.sm} font-medium ${(m=(u=s)==null?void 0:u.colors)==null?void 0:m.text.secondary} mb-2`,children:"Durum *"}),e.jsx("select",{value:l.status,onChange:t=>c({...l,status:t.target.value}),className:p("md","default",void 0,"md"),children:Ce.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(le=(r=s)==null?void 0:r.typography)==null?void 0:le.body.sm} font-medium ${(d=(i=s)==null?void 0:i.colors)==null?void 0:d.text.secondary} mb-2`,children:"Makbuz/Fatura"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 border border-neutral-300 rounded-xl hover:bg-neutral-50 transition-colors",children:[e.jsx(fe,{size:18}),e.jsx("span",{className:"text-sm",children:M?"Yükleniyor...":"Dosya Seç"})]}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg,application/pdf",onChange:C,className:"hidden",disabled:M})]}),l.receiptUrl&&e.jsx("a",{href:l.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-neutral-900 hover:text-neutral-900",children:"Makbuzu Görüntüle"})]}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"JPG, PNG veya PDF (max 5MB)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${(ue=(xe=s)==null?void 0:xe.typography)==null?void 0:ue.body.sm} font-medium ${(pe=(he=s)==null?void 0:he.colors)==null?void 0:pe.text.secondary} mb-2`,children:"Notlar"}),e.jsx("textarea",{value:l.notes,onChange:t=>c({...l,notes:t.target.value}),className:p("md","default",void 0,"md"),rows:2,placeholder:"Ek notlar..."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-neutral-200",children:[e.jsx("button",{type:"button",onClick:S,className:y("md","outline","lg"),children:"İptal"}),e.jsx("button",{type:"submit",disabled:Y,className:x(y("md","primary","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:Y?"Kaydediliyor...":o?"Güncelle":"Kaydet"})]})]})]})}):null}const N="px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase tracking-wider bg-neutral-50",v="px-6 py-4 text-sm text-neutral-900";function Le(){var B,K,L,O,R,U;const[g,S]=n.useState([]),[ne,o]=n.useState(!1),[l,c]=n.useState(!1),[Y,w]=n.useState(null),[M,_]=n.useState(""),[C,ie]=n.useState(""),[E,I]=n.useState(""),[$,de]=n.useState(""),[P,ce]=n.useState(""),[j,F]=n.useState(1),[D,G]=n.useState(1),W=10,[q,H]=n.useState(0),[J,X]=n.useState(0),[A,V]=n.useState([]);n.useEffect(()=>{z(),Q()},[j,C,E,$,P]);const z=async()=>{var a,u,m;o(!0);try{const r=await re.getExpenses({page:j,limit:W,category:C||void 0,status:E||void 0,startDate:$||void 0,endDate:P||void 0,search:M||void 0});S(((a=r==null?void 0:r.data)==null?void 0:a.data)||[]),G(((m=(u=r==null?void 0:r.data)==null?void 0:u.pagination)==null?void 0:m.totalPages)||1)}catch(r){console.warn("Failed to load expenses:",r),S([]),G(1)}finally{o(!1)}},Q=async()=>{try{const a=g.reduce((i,d)=>i+d.amount,0);H(a);const u=new Date().getMonth(),m=g.filter(i=>new Date(i.date).getMonth()===u).reduce((i,d)=>i+d.amount,0);X(m);const r=new Map;g.forEach(i=>{const d=r.get(i.category)||{total:0,count:0};r.set(i.category,{total:d.total+i.amount,count:d.count+1})});const le=Array.from(r.entries()).map(([i,d])=>({category:i,total:d.total,count:d.count,percentage:d.total/a*100}));V(le.sort((i,d)=>d.total-i.total))}catch(a){console.error("Stats calculation error:",a)}},Z=async a=>{var u,m;if(confirm("Bu gider kaydını silmek istediğinizden emin misiniz?"))try{await re.deleteExpense(a),h.success("Gider kaydı silindi"),z()}catch(r){console.error("Failed to delete expense:",r),h.error("Silme işlemi başarısız: "+(((m=(u=r.response)==null?void 0:u.data)==null?void 0:m.message)||r.message))}},ee=a=>{w(a),c(!0)},ae=()=>{h.success("Dışa aktarma başlatıldı")},b=a=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),te=a=>new Date(a).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric"}),se=a=>{const m=ye({paid:"paid",pending:"partial",cancelled:"overdue"}[a]||a,"invoice","sm","solid");return e.jsx("span",{className:m.className,children:m.label})};return e.jsxs("div",{className:"space-y-6",style:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",style:{boxSizing:"border-box"},children:[e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(Ne,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Bu Ay"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:b(J)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Aylık Gider"})]}),e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(ve,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Toplam"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:b(q)}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Toplam Gider"})]}),e.jsxs("div",{className:k("sm","sm","default","lg"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:me("primary"),children:e.jsx(je,{className:"text-white",size:16})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600",children:"Kayıt"})]}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900 mb-0.5",children:g.length}),e.jsx("p",{className:"text-xs font-medium text-neutral-600",children:"Gider Kaydı"})]})]}),A.length>0&&e.jsxs("div",{className:k("sm","md","default","lg"),children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 mb-4",children:"Kategori Dağılımı"}),e.jsx("div",{className:"space-y-3",children:A.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:a.category}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-neutral-500",children:[a.count," kayıt"]}),e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:b(a.total)})]})]}),e.jsx("div",{className:"w-full bg-neutral-100 rounded-full h-2",children:e.jsx("div",{className:"bg-neutral-900 h-2 rounded-full transition-all",style:{width:`${a.percentage}%`}})})]},a.category))})]}),e.jsx("div",{className:k("sm","none","default","lg"),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${(K=(B=s)==null?void 0:B.colors)==null?void 0:K.text.muted}`,size:18}),e.jsx("input",{type:"text",placeholder:"Gider ara...",value:M,onChange:a=>_(a.target.value),className:x(p("md","default",void 0,"md"),"pl-10")})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",style:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("select",{value:C,onChange:a=>ie(a.target.value),className:x(p("md","default",void 0,"md"),"flex-1 min-w-[150px] max-w-[200px]"),style:{boxSizing:"border-box"},children:[e.jsx("option",{value:"",children:"Tüm Kategoriler"}),e.jsx("option",{value:"Personel Maaşları",children:"Personel Maaşları"}),e.jsx("option",{value:"Kira",children:"Kira"}),e.jsx("option",{value:"Elektrik/Su/Doğalgaz",children:"Elektrik/Su/Doğalgaz"}),e.jsx("option",{value:"Ekipman Bakım/Onarım",children:"Ekipman Bakım/Onarım"}),e.jsx("option",{value:"Diğer",children:"Diğer"})]}),e.jsxs("select",{value:E,onChange:a=>I(a.target.value),className:x(p("md","default",void 0,"md"),"flex-1 min-w-[130px]"),children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"paid",children:"Ödendi"}),e.jsx("option",{value:"pending",children:"Beklemede"}),e.jsx("option",{value:"cancelled",children:"İptal"})]}),e.jsxs("button",{onClick:ae,className:x(y("md","outline","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(Se,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Dışa Aktar"})]}),e.jsxs("button",{onClick:()=>{w(null),c(!0)},className:x(y("md","primary","md"),"gap-2 whitespace-nowrap"),children:[e.jsx(we,{size:18}),e.jsx("span",{children:"Yeni Gider"})]})]})]})}),e.jsx("div",{className:k("none","sm","default","lg"),style:{overflow:"hidden",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:ne?e.jsx("div",{className:"p-12 text-center text-neutral-600",children:"Yükleniyor..."}):g.length===0?e.jsxs("div",{className:"p-12 text-center text-neutral-600",children:[e.jsx(je,{className:"mx-auto mb-4 text-neutral-400",size:48}),e.jsx("p",{className:"text-lg font-medium",children:"Gider kaydı bulunamadı"}),e.jsx("p",{className:"text-sm mt-2",children:"Yeni gider ekleyerek başlayın"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",style:{maxWidth:"100%",width:"100%"},children:e.jsxs("table",{className:"w-full",style:{tableLayout:"fixed",width:"100%",maxWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:N,children:"Tarih"}),e.jsx("th",{className:N,children:"Açıklama"}),e.jsx("th",{className:`${N} hidden md:table-cell`,children:"Kategori"}),e.jsx("th",{className:N,children:"Tutar"}),e.jsx("th",{className:`${N} hidden lg:table-cell`,children:"Ödeme"}),e.jsx("th",{className:`${N} hidden md:table-cell`,children:"Durum"}),e.jsx("th",{className:N,children:"İşlemler"})]})}),e.jsx("tbody",{children:g.map(a=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors",children:[e.jsx("td",{className:v,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{size:14,className:"text-neutral-400"}),e.jsx("span",{className:"text-sm text-neutral-900",children:te(a.date)})]})}),e.jsx("td",{className:v,children:e.jsx("div",{className:"text-sm font-medium text-neutral-900",children:a.description})}),e.jsx("td",{className:`${v} hidden md:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.category})}),e.jsx("td",{className:v,children:e.jsx("span",{className:"text-sm font-semibold text-neutral-900",children:b(a.amount)})}),e.jsx("td",{className:`${v} hidden lg:table-cell`,children:e.jsx("span",{className:"text-sm text-neutral-600",children:a.paymentMethod})}),e.jsx("td",{className:`${v} hidden md:table-cell`,children:se(a.status)}),e.jsx("td",{className:v,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ee(a),className:x(y("sm","ghost","lg"),"p-2"),title:"Düzenle",children:e.jsx(De,{size:16})}),e.jsx("button",{onClick:()=>Z(a.id),className:x(y("sm","ghost","lg"),"p-2"),title:"Sil",children:e.jsx(ze,{size:16})})]})})]},a.id))})]})}),e.jsxs("div",{className:(O=(L=s)==null?void 0:L.pagination)==null?void 0:O.container,children:[e.jsxs("div",{className:(U=(R=s)==null?void 0:R.pagination)==null?void 0:U.info,children:["Sayfa ",j," / ",D]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F(a=>Math.max(1,a-1)),disabled:j===1,className:x(y("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Önceki"}),e.jsx("button",{onClick:()=>F(a=>Math.min(D,a+1)),disabled:j===D,className:x(y("md","outline","lg"),"disabled:opacity-50 disabled:cursor-not-allowed"),children:"Sonraki"})]})]})]})}),e.jsx($e,{open:l,onClose:()=>{c(!1),w(null)},onSaved:z,initial:Y})]})}export{Le as default};
